<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½¯ä»¶å®‰è£…å¤§å¸ˆ - é»‘å®¢æŒ‘æˆ˜èµ›</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: linear-gradient(to bottom, #3a6ea5, #0a2c5a);
            --desktop-bg: #008080;
            --taskbar-bg: linear-gradient(to bottom, #0a246a, #a6caf0);
            --window-bg: #d4d0c8;
            --window-border: #0a0a0a;
            --window-header-bg: linear-gradient(to right, #0a246a, #3a6ea5);
            --btn-bg: linear-gradient(to bottom, #d4d0c8, #808080);
            --btn-hover-bg: linear-gradient(to bottom, #e0e0e0, #a0a0a0);
            --coins-bg: linear-gradient(to bottom, #ffcc00, #cc9900);
            --warning-color: #cc0000;
            --success-color: #008800;
            --font-main: 'Tahoma', 'Arial', sans-serif;
            --shadow: 3px 3px 10px rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-main);
            user-select: none;
        }
        
        body {
            background: var(--primary-bg);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
            overflow: hidden;
            padding: 20px;
        }
        
        .container {
            width: min(900px, 95%);
            height: min(600px, 95vh);
            background: var(--window-bg);
            border: 2px solid var(--window-border);
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.3), inset 1px 1px 0px #ffffff;
            position: relative;
            overflow: hidden;
        }
        
        .desktop {
            width: 100%;
            height: 100%;
            background: var(--desktop-bg);
            position: relative;
            transition: background 0.5s;
        }
        
        .desktop.red-screen {
            background: #8b0000;
            background-image: linear-gradient(45deg, #8b0000 25%, #ff0000 25%, #ff0000 50%, #8b0000 50%, #8b0000 75%, #ff0000 75%, #ff0000 100%);
            background-size: 56.57px 56.57px;
        }
        
        .desktop.shutdown {
            background: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .taskbar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30px;
            background: var(--taskbar-bg);
            border-top: 1px solid #ffffff;
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 100;
        }
        
        .start-btn {
            background: linear-gradient(to bottom, #33cc33, #008800);
            color: white;
            border: 1px solid #008800;
            border-radius: 3px;
            padding: 2px 15px 2px 30px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            box-shadow: inset 1px 1px 0px #66ff66;
            text-shadow: 1px 1px 1px #004400;
        }
        
        .start-btn::before {
            content: "ğŸŸ¢";
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .window {
            position: absolute;
            background: var(--window-bg);
            border: 2px solid;
            border-top-color: #ffffff;
            border-left-color: #ffffff;
            border-right-color: #808080;
            border-bottom-color: #808080;
            min-width: 400px;
            display: none;
            box-shadow: var(--shadow);
            z-index: 10;
        }
        
        .window-header {
            background: var(--window-header-bg);
            padding: 5px 8px;
            border-bottom: 1px solid #ffffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .window-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .close-btn {
            background: var(--window-bg);
            color: #000;
            border: 1px solid #808080;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            box-shadow: inset -1px -1px 0px #000000;
        }
        
        .window-content {
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            background: #ffffff;
            border: 1px solid #808080;
            margin: 2px;
        }
        
        .mail-icon {
            position: absolute;
            top: 50px;
            left: 50px;
            width: 48px;
            height: 64px;
            background: #ffffff;
            border: 1px solid #808080;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: inset -1px -1px 0px #000000;
            text-align: center;
            padding: 5px;
            z-index: 5;
        }
        
        .mail-icon:hover {
            transform: scale(1.05);
            background: #e0e0e0;
        }
        
        .mail-icon::before {
            content: "âœ‰";
            font-size: 24px;
            color: #3a6ea5;
            margin-bottom: 5px;
        }
        
        .notification {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffffcc;
            border: 2px solid #ffcc00;
            padding: 10px;
            font-size: 14px;
            display: none;
            box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);
            z-index: 5;
            width: 250px;
        }
        
        .btn {
            background: var(--btn-bg);
            color: #000;
            border: 1px solid #808080;
            padding: 5px 15px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            box-shadow: inset -1px -1px 0px #000000;
            min-width: 80px;
        }
        
        .btn:hover {
            background: var(--btn-hover-bg);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .checkbox-container {
            margin: 10px 0;
            padding: 5px;
            display: flex;
            align-items: center;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            font-size: 14px;
        }
        
        .checkbox-label input {
            margin-right: 10px;
        }
        
        .hidden-checkbox {
            display: none;
        }
        
        .fake-checkbox {
            width: 16px;
            height: 16px;
            background: #ffffff;
            border: 1px solid #808080;
            display: inline-block;
            margin-right: 8px;
            position: relative;
            box-shadow: inset -1px -1px 0px #000000;
        }
        
        .fake-checkbox::after {
            content: "âœ“";
            position: absolute;
            top: -2px;
            left: 1px;
            color: #000;
            font-size: 14px;
            opacity: 0;
        }
        
        .hidden-checkbox:checked + .fake-checkbox::after {
            opacity: 1;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: var(--window-bg);
            border: 1px solid #808080;
            margin: 15px 0;
            position: relative;
            box-shadow: inset -1px -1px 0px #000000;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to bottom, #33cc33, #008800);
            width: 0%;
            transition: width 0.3s;
        }
        
        .coins-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--coins-bg);
            border: 1px solid #996600;
            padding: 5px 15px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            z-index: 5;
        }
        
        .history-btn {
            position: absolute;
            bottom: 40px;
            right: 10px;
            background: var(--btn-bg);
            color: #000;
            border: 1px solid #808080;
            padding: 5px 15px;
            cursor: pointer;
            display: none;
            font-weight: bold;
            box-shadow: inset -1px -1px 0px #000000;
            z-index: 5;
        }
        
        .faded-button {
            opacity: 0.5;
        }
        
        .faded-button:hover {
            opacity: 1;
        }
        
        .small-text {
            font-size: 10px;
            color: #666;
            margin-top: 5px;
            padding-left: 25px;
            line-height: 1.3;
        }
        
        .time-display {
            position: absolute;
            right: 10px;
            bottom: 5px;
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 1px #000;
        }
        
        .desktop-icon {
            position: absolute;
            width: 64px;
            text-align: center;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 1px #000;
            cursor: pointer;
            z-index: 5;
        }
        
        .desktop-icon img {
            width: 48px;
            height: 48px;
            display: block;
            margin: 0 auto 5px;
        }
        
        .title-bar {
            background: var(--window-header-bg);
            color: white;
            padding: 3px 10px;
            font-weight: bold;
            font-size: 14px;
            border-bottom: 1px solid #ffffff;
        }
        
        .agreement-text {
            height: 150px;
            overflow-y: scroll;
            border: 1px solid #808080;
            padding: 10px;
            margin: 10px 0;
            background: #fff;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .popup-ad {
            position: absolute;
            width: 300px;
            background: white;
            border: 2px solid #ff0000;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
            display: none;
            z-index: 100;
        }
        
        .popup-header {
            background: linear-gradient(to right, #ff0000, #cc0000);
            padding: 5px;
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }
        
        .popup-content {
            padding: 15px;
            text-align: center;
        }
        
        .popup-content img {
            max-width: 100%;
            margin: 10px 0;
        }
        
        .ransom-note {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border: 2px solid #f00;
        }
        
        .blinking {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            50% { opacity: 0.5; }
        }
        
        .task-icon {
            height: 24px;
            margin-right: 5px;
            display: flex;
            align-items: center;
            padding: 0 5px;
            border: 1px solid transparent;
            border-radius: 3px;
        }
        
        .task-icon.active {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        .taskbar-icons {
            display: flex;
            margin-left: 20px;
        }
        
        .desktop-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - 30px);
            background-image: url('https://i.pinimg.com/originals/8f/45/0b/8f450b4f4d1d6061f8f2a4f8a8f4d4d4.jpg');
            background-size: cover;
            opacity: 0.1;
            z-index: 0;
        }
        
        .virus-icon {
            position: absolute;
            animation: float 3s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .easter-egg {
            position: absolute;
            width: 20px;
            height: 20px;
            background: transparent;
            z-index: 200;
        }
        
        .virus-notice {
            position: absolute;
            top: 40px;
            right: 10px;
            background: #ffdddd;
            border: 2px solid #ff0000;
            padding: 10px;
            font-size: 12px;
            display: none;
            z-index: 150;
            width: 200px;
        }
        
        .preview-image {
            width: 100%;
            height: 150px;
            background: #eee;
            border: 1px solid #ccc;
            margin: 10px 0;
            position: relative;
            cursor: move;
            overflow: hidden;
        }
        
        .preview-image img {
            position: absolute;
            max-width: 100%;
            max-height: 100%;
            top: 0;
            left: 0;
        }
        
        .required-option {
            border-left: 3px solid #0066cc;
            padding-left: 5px;
        }
        
        .virus-warning {
            color: var(--warning-color);
            font-weight: bold;
        }
        
        .system-icon {
            position: absolute;
            width: 64px;
            text-align: center;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 1px #000;
            cursor: pointer;
            z-index: 5;
        }
        
        .system-icon i {
            display: block;
            font-size: 36px;
            margin-bottom: 5px;
        }
        
        .mail-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .mail-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .mail-item {
            padding: 8px;
            border-bottom: 1px solid #ccc;
            cursor: pointer;
        }
        
        .mail-item:hover {
            background-color: #f0f0f0;
        }
        
        .mail-item.unread {
            font-weight: bold;
        }
        
        .mail-item.selected {
            background-color: #e0e0ff;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        
        .page-btn {
            padding: 3px 8px;
            margin: 0 2px;
            cursor: pointer;
        }
        
        .page-btn.active {
            background: #0a246a;
            color: white;
        }
        
        .mail-actions {
            display: flex;
            justify-content: flex-end;
            gap: 5px;
            margin-top: 5px;
        }
        
        .action-btn {
            padding: 2px 8px;
            font-size: 12px;
        }
        
        .file-list {
            list-style: none;
            margin: 10px 0;
            padding: 0;
        }
        
        .file-list li {
            padding: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .file-list li i {
            margin-right: 8px;
            font-size: 16px;
        }
        
        .file-list li:hover {
            background-color: #e0e0e0;
        }
        
        .drive-info {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
        }
        
        .shutdown-screen {
            background: #000;
            color: #fff;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 1000;
            display: none;
        }
        
        .shutdown-screen h1 {
            font-size: 48px;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 0 0 10px #00f, 0 0 20px #00f;
        }
        
        .shutdown-screen p {
            font-size: 24px;
            margin: 10px 0;
            max-width: 80%;
        }
        
        .ending-screen {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 1000;
            color: white;
            display: none;
        }
        
        .ending-content {
            background: rgba(0, 0, 0, 0.7);
            padding: 40px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .ending-screen h1 {
            font-size: 48px;
            margin-bottom: 30px;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }
        
        .ending-screen p {
            font-size: 24px;
            margin: 20px 0;
            line-height: 1.5;
        }
        
        .ending-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            min-width: 150px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #ffcc00;
        }
        
        .stat-label {
            font-size: 18px;
            margin-top: 10px;
        }
        
        .start-menu-item {
            padding: 8px 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            border-radius: 3px;
        }
        
        .start-menu-item:hover {
            background: #0a246a;
            color: white;
        }
        
        .start-menu-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .drive-icon {
            font-size: 24px;
            margin-right: 10px;
            color: #3a6ea5;
        }
        
        .disk-usage {
            height: 10px;
            background: var(--window-bg);
            border: 1px solid #808080;
            margin: 5px 0;
            position: relative;
        }
        
        .disk-used {
            height: 100%;
            background: #3a6ea5;
        }
        
        .context-menu {
            position: absolute;
            background: var(--window-bg);
            border: 1px solid #808080;
            box-shadow: 3px 3px 5px rgba(0,0,0,0.3);
            z-index: 200;
            display: none;
            min-width: 150px;
        }
        
        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        
        .context-menu-item:hover {
            background: #0a246a;
            color: white;
        }
        
        .context-menu-item i {
            margin-right: 8px;
            width: 20px;
            text-align: center;
        }
        
        .minesweeper {
            width: 300px;
            background: var(--window-bg);
            border: 2px solid #808080;
            padding: 10px;
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }
        
        .minesweeper-header {
            background: #0a246a;
            color: white;
            padding: 5px;
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .minesweeper-grid {
            display: grid;
            grid-template-columns: repeat(7, 24px);
            grid-template-rows: repeat(7, 24px);
            gap: 1px;
            background: #b0b0b0;
            padding: 1px;
        }
        
        .cell {
            width: 24px;
            height: 24px;
            background: #c0c0c0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            border: 2px outset #fff;
            font-size: 14px;
        }
        
        .cell.revealed {
            border: 1px solid #808080;
            background: #c0c0c0;
        }
        
        .cell.flagged::before {
            content: "ğŸš©";
        }
        
        .cell.mine::before {
            content: "ğŸ’£";
        }
        
        .cell.star::before {
            content: "â­";
        }
        
        .shortcut-icon {
            position: absolute;
            width: 64px;
            text-align: center;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 1px #000;
            cursor: pointer;
            z-index: 5;
        }
        
        .shortcut-icon i {
            display: block;
            font-size: 36px;
            margin-bottom: 5px;
        }
        
        .firewall-status {
            padding: 5px;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
        }
        
        .firewall-on {
            background: #ccffcc;
            border: 1px solid #008000;
            color: #008000;
        }
        
        .firewall-off {
            background: #ffcccc;
            border: 1px solid #800000;
            color: #800000;
        }
        
        /* å…³æœºåŠ¨ç”» */
        .shutdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0);
            z-index: 999;
            display: none;
        }
        
        /* å›æ”¶ç«™é¡¹ç›® */
        .trash-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            border-bottom: 1px solid #ccc;
        }
        
        .trash-item-name {
            flex: 1;
        }
        
        .trash-item-date {
            font-size: 10px;
            color: #666;
            margin-right: 10px;
        }
        
        /* ç£ç›˜åˆ—è¡¨ */
        .disk-list {
            list-style: none;
            margin: 10px 0;
        }
        
        .disk-list li {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .disk-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .disk-space {
            font-size: 12px;
            color: #666;
        }
        
        .disk-usage-bar {
            height: 8px;
            background: var(--window-bg);
            border: 1px solid #808080;
            margin-top: 5px;
            position: relative;
        }
        
        .disk-used-bar {
            height: 100%;
            background: #3a6ea5;
        }
        
        /* ä»»åŠ¡ç®¡ç†å™¨æ ·å¼ */
        .task-manager-list {
            list-style: none;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 5px;
        }
        
        .task-manager-item {
            display: flex;
            justify-content: space-between;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .task-manager-item:hover {
            background-color: #f0f0f0;
        }
        
        .task-manager-item-name {
            flex: 1;
        }
        
        /* å‘½ä»¤è¡Œæ ·å¼ */
        .cmd-window {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-size: 14px;
        }
        
        .cmd-input {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        .cmd-prompt {
            color: #0f0;
            margin-right: 5px;
        }
        
        .cmd-input-field {
            background: transparent;
            border: none;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            width: calc(100% - 60px);
            outline: none;
        }
        
        /* æ–‡ä»¶èµ„æºç®¡ç†å™¨ */
        .explorer-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ccc;
        }
        
        .explorer-toolbar button {
            padding: 3px 8px;
            font-size: 12px;
        }
        
        .explorer-breadcrumb {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 3px;
            background: #f0f0f0;
            border: 1px solid #ccc;
        }
        
        .breadcrumb-item {
            cursor: pointer;
            padding: 2px 5px;
        }
        
        .breadcrumb-item:hover {
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            margin: 0 5px;
        }
        
        .explorer-view {
            display: flex;
        }
        
        .explorer-folders {
            width: 30%;
            border-right: 1px solid #ccc;
            padding-right: 10px;
            overflow-y: auto;
            max-height: 250px;
        }
        
        .explorer-files {
            width: 70%;
            padding-left: 10px;
            overflow-y: auto;
            max-height: 250px;
        }
        
        .explorer-item {
            padding: 5px;
            cursor: pointer;
        }
        
        .explorer-item:hover {
            background-color: #e0e0ff;
        }
        
        /* æ–°æ·»åŠ çš„æ ·å¼ï¼šå·²å®‰è£…é‚®ä»¶æ ·å¼å’Œè°ƒè¯•æ¨¡å¼æ ·å¼ */
        .mail-item.installed {
            opacity: 0.6;
            background-color: #f0f0f0;
            text-decoration: line-through;
        }
        
        .virus-option {
            color: #cc0000;
            font-weight: bold;
        }
        
        .debug-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #0f0;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 3px;
            z-index: 200;
            font-family: 'Courier New', monospace;
        }
        
        .debug-toggle {
            position: absolute;
            top: 10px;
            left: 150px;
            background: #ffcc00;
            border: 1px solid #996600;
            padding: 5px 10px;
            font-size: 12px;
            font-weight: bold;
            border-radius: 3px;
            cursor: pointer;
            z-index: 200;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="desktop" id="desktop">
            <div class="desktop-bg"></div>
            <div class="title-bar">Windows XP Professional</div>
            
            <!-- é‚®ä»¶å›¾æ ‡ä½œä¸ºæ¡Œé¢åº”ç”¨ -->
            <div class="system-icon" id="mailIcon" style="top: 50px; left: 50px;">
                <i class="fas fa-envelope"></i>
                <div>é‚®ä»¶</div>
            </div>
            
            <div class="system-icon" id="myComputer" style="top: 150px; left: 50px;">
                <i class="fas fa-desktop"></i>
                <div>æˆ‘çš„ç”µè„‘</div>
            </div>
            
            <div class="system-icon" id="recycleBin" style="top: 150px; left: 150px;">
                <i class="fas fa-trash-alt"></i>
                <div>å›æ”¶ç«™</div>
            </div>
            
            <div class="coins-display" id="coinsDisplay">
                é‡‘å¸: <span id="coinsCount">50</span>
            </div>
            
            <div class="notification" id="notification">
                <div>ä½ æœ‰æ–°é‚®ä»¶ï¼</div>
                <div>å‘ä»¶äºº: blackhat_challenger@hackers.org</div>
            </div>
            
            <div class="virus-notice" id="virusNotice">
                <div style="color:red;font-weight:bold;">è­¦å‘Š!</div>
                <div>æ£€æµ‹åˆ°ç³»ç»Ÿä¸­æœ‰åƒåœ¾è½¯ä»¶</div>
                <div>æ•°é‡: <span id="virusCount">0</span></div>
            </div>
            
            <button class="history-btn" id="historyBtn">â†© å›åˆ°ä¸Šä¸€æ¬¡</button>
            
            <div class="taskbar">
                <button class="start-btn" id="startBtn">å¼€å§‹</button>
                <div class="taskbar-icons">
                    <div class="task-icon" id="mailTask"><i class="fas fa-envelope"></i></div>
                    <div class="task-icon" id="installTask"><i class="fas fa-download"></i></div>
                </div>
                <div class="time-display" id="timeDisplay">15:30</div>
            </div>
            
            <!-- è°ƒè¯•æ¨¡å¼å¼€å…³ -->
            <div class="debug-toggle" id="debugToggle">è°ƒè¯•æ¨¡å¼: å…³</div>
            
            <!-- å½©è›‹åŒºåŸŸ -->
            <div class="easter-egg" style="top: 200px; left: 300px;"></div>
            <div class="easter-egg" style="top: 400px; left: 700px;"></div>
        </div>
        
        <!-- å…³æœºåŠ¨ç”»é®ç½© -->
        <div class="shutdown-overlay" id="shutdownOverlay"></div>
        
        <!-- å³é”®èœå• -->
        <div class="context-menu" id="contextMenu">
            <div class="context-menu-item" id="newFolderItem"><i class="fas fa-folder-plus"></i>æ–°å»ºæ–‡ä»¶å¤¹</div>
            <div class="context-menu-item" id="shortcutItem"><i class="fas fa-link"></i>åˆ›å»ºå¿«æ·æ–¹å¼</div>
            <div class="context-menu-item" id="refreshItem"><i class="fas fa-sync-alt"></i>åˆ·æ–°</div>
            <div class="context-menu-item" id="propertiesItem"><i class="fas fa-cog"></i>å±æ€§</div>
        </div>
        
        <!-- å¼€å§‹èœå• -->
        <div class="window" id="startMenu" style="bottom: 35px; left: 10px; width: 300px; height: 400px; display: none;">
            <div class="window-header">
                <div class="window-title">å¼€å§‹èœå•</div>
                <div class="close-btn" id="closeStartMenu">Ã—</div>
            </div>
            <div class="window-content">
                <div style="background: #0a246a; color: white; padding: 5px; margin-bottom: 10px;">
                    é»‘å¸½æŒ‘æˆ˜èµ›
                </div>
                <div class="start-menu-item" id="profileItem">
                    <i class="fas fa-user"></i> ç©å®¶æ¡£æ¡ˆ
                </div>
                <div class="start-menu-item" id="mailClientItem">
                    <i class="fas fa-envelope"></i> é‚®ä»¶å®¢æˆ·ç«¯
                </div>
                <div class="start-menu-item" id="gamesItem">
                    <i class="fas fa-gamepad"></i> å°æ¸¸æˆ
                </div>
                <div class="start-menu-item" id="controlPanelItem">
                    <i class="fas fa-cog"></i> æ§åˆ¶é¢æ¿
                </div>
                <div class="start-menu-item" id="taskManagerItem">
                    <i class="fas fa-tasks"></i> ä»»åŠ¡ç®¡ç†å™¨
                </div>
                <div class="start-menu-item" id="cmdItem">
                    <i class="fas fa-terminal"></i> å‘½ä»¤æç¤ºç¬¦
                </div>
                <div style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px;">
                    <div class="start-menu-item" id="shutdownItem">
                        <i class="fas fa-power-off"></i> å…³é—­è®¡ç®—æœº
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é‚®ä»¶çª—å£ -->
        <div class="window" id="mailWindow" style="top: 100px; left: 100px; width: 600px;">
            <div class="window-header">
                <div class="window-title">æ”¶ä»¶ç®± - é»‘å¸½æŒ‘æˆ˜èµ›</div>
                <div class="close-btn" id="closeMail">Ã—</div>
            </div>
            <div class="window-content">
                <div class="mail-nav">
                    <div>
                        <button class="btn" id="inboxBtn">æ”¶ä»¶ç®±</button>
                        <button class="btn" id="sentBtn">å·²å‘é€</button>
                    </div>
                    <div>
                        <button class="btn" id="newMailBtn">æ–°å»ºé‚®ä»¶</button>
                        <button class="btn" id="deleteMailBtn">åˆ é™¤é‚®ä»¶</button>
                    </div>
                </div>
                
                <div class="mail-list" id="mailList">
                    <!-- é‚®ä»¶åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="pagination">
                    <button class="page-btn" id="prevPageBtn">ä¸Šä¸€é¡µ</button>
                    <button class="page-btn active" id="page1Btn">1</button>
                    <button class="page-btn" id="page2Btn">2</button>
                    <button class="page-btn" id="nextPageBtn">ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>
        
        <!-- é‚®ä»¶é˜…è¯»çª—å£ -->
        <div class="window" id="mailViewWindow" style="top: 150px; left: 200px; width: 500px; display: none;">
            <div class="window-header">
                <div class="window-title">é˜…è¯»é‚®ä»¶</div>
                <div class="close-btn" id="closeMailView">Ã—</div>
            </div>
            <div class="window-content" id="mailViewContent">
                <!-- é‚®ä»¶å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- å®‰è£…ç¨‹åºçª—å£ -->
        <div class="window" id="installWindow" style="top: 150px; left: 200px; width: 500px;">
            <div class="window-header">
                <div class="window-title">è½¯ä»¶å®‰è£…å‘å¯¼</div>
                <div class="close-btn" id="closeInstall">Ã—</div>
            </div>
            <div class="window-content" id="installContent">
                <!-- å®‰è£…æ­¥éª¤å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- ç»“æœçª—å£ -->
        <div class="window" id="resultWindow" style="top: 200px; left: 250px; width: 400px;">
            <div class="window-header">
                <div class="window-title">å®‰è£…ç»“æœ</div>
                <div class="close-btn" id="closeResult">Ã—</div>
            </div>
            <div class="window-content" id="resultContent">
                <!-- ç»“æœå†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- å¹¿å‘Šå¼¹çª— -->
        <div class="popup-ad" id="popupAd" style="top: 50px; left: 400px;">
            <div class="popup-header">
                <div>ç‰¹åˆ«ä¼˜æƒ !</div>
                <div class="close-btn" id="closeAd">Ã—</div>
            </div>
            <div class="popup-content">
                <h3>æ‚¨çš„ç”µè„‘è¿è¡Œç¼“æ…¢?</h3>
                <p>ç«‹å³ä¸‹è½½SuperCleanerä¼˜åŒ–æ‚¨çš„ç³»ç»Ÿ!</p>
                <div style="background:#eee;padding:10px;margin:10px 0;">
                    <img src="https://static.thenounproject.com/png/3628266-200.png" alt="å¹¿å‘Š" style="width:100px;height:100px;">
                </div>
                <button class="btn" id="downloadAdBtn">å…è´¹ä¸‹è½½</button>
            </div>
        </div>
        
        <!-- å‹’ç´¢çª—å£ -->
        <div class="popup-ad" id="ransomWindow" style="top: 150px; left: 300px; width: 350px; display: none;">
            <div class="popup-header">
                <div>è­¦å‘Š!</div>
                <div class="close-btn" id="closeRansom">Ã—</div>
            </div>
            <div class="popup-content">
                <div class="ransom-note">
                    <h3 class="blinking">!!! è­¦å‘Š !!!</h3>
                    <p>æ‚¨çš„æ–‡ä»¶å·²è¢«åŠ å¯†!</p>
                    <p>è¦è§£å¯†æ–‡ä»¶ï¼Œè¯·æ”¯ä»˜10é‡‘å¸</p>
                    <p>æ‚¨æœ‰ <span id="countdown">60</span> ç§’æ—¶é—´</p>
                    <p>å¦åˆ™æ‰€æœ‰æ–‡ä»¶å°†è¢«æ°¸ä¹…åˆ é™¤</p>
                    <div style="margin-top: 15px;">
                        <button class="btn" id="payRansomBtn">æ”¯ä»˜é‡‘å¸</button>
                        <button class="btn" id="ignoreRansomBtn">å¿½ç•¥</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æˆ‘çš„ç”µè„‘çª—å£ -->
        <div class="window" id="myComputerWindow" style="top: 100px; left: 200px; width: 500px; display: none;">
            <div class="window-header">
                <div class="window-title">æˆ‘çš„ç”µè„‘</div>
                <div class="close-btn" id="closeMyComputer">Ã—</div>
            </div>
            <div class="window-content">
                <div class="explorer-toolbar">
                    <button class="btn" id="backBtn"><i class="fas fa-arrow-left"></i></button>
                    <button class="btn" id="forwardBtn"><i class="fas fa-arrow-right"></i></button>
                    <button class="btn" id="upBtn"><i class="fas fa-arrow-up"></i></button>
                </div>
                
                <div class="explorer-breadcrumb" id="breadcrumb">
                    <div class="breadcrumb-item" data-path="root">æˆ‘çš„ç”µè„‘</div>
                </div>
                
                <div class="explorer-view">
                    <div class="explorer-folders" id="folderPane">
                        <!-- æ–‡ä»¶å¤¹åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <div class="explorer-files" id="filePane">
                        <!-- æ–‡ä»¶åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="drive-info">
                    <div>å¯ç”¨ç©ºé—´: 2.5 GB / æ€»ç©ºé—´: 20 GB</div>
                    <div class="disk-usage-bar">
                        <div class="disk-used-bar" style="width: 85%;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å›æ”¶ç«™çª—å£ -->
        <div class="window" id="recycleBinWindow" style="top: 150px; left: 250px; width: 350px; display: none;">
            <div class="window-header">
                <div class="window-title">å›æ”¶ç«™</div>
                <div class="close-btn" id="closeRecycleBin">Ã—</div>
            </div>
            <div class="window-content">
                <p>å›æ”¶ç«™ä¸­æœ‰ <strong id="trashCount">3</strong> ä¸ªé¡¹ç›® (å…± 15.2 MB)</p>
                <div id="trashItems">
                    <!-- å›æ”¶ç«™é¡¹ç›®å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn" id="emptyBinBtn">æ¸…ç©ºå›æ”¶ç«™</button>
                    <button class="btn" id="restoreAllBtn">è¿˜åŸæ‰€æœ‰é¡¹ç›®</button>
                </div>
            </div>
        </div>
        
        <!-- ç©å®¶æ¡£æ¡ˆçª—å£ -->
        <div class="window" id="profileWindow" style="top: 150px; left: 300px; width: 350px; display: none;">
            <div class="window-header">
                <div class="window-title">ç©å®¶æ¡£æ¡ˆ</div>
                <div class="close-btn" id="closeProfile">Ã—</div>
            </div>
            <div class="window-content">
                <h3>ç©å®¶ä¿¡æ¯</h3>
                <div style="margin: 15px 0;">
                    <label>ç©å®¶åç§°:</label>
                    <input type="text" id="playerNameInput" value="æŒ‘æˆ˜è€…" style="width: 100%; padding: 5px; margin: 5px 0;">
                </div>
                
                <h3>æŒ‘æˆ˜è¿›åº¦</h3>
                <p>å·²å®‰è£…è½¯ä»¶: <span id="installedCountProfile">0</span>/8</p>
                <p>å‰©ä½™é‡‘å¸: <span id="coinsProfile">50</span></p>
                <p>æ£€æµ‹åˆ°ç—…æ¯’: <span id="virusesProfile">0</span></p>
                
                <div style="margin-top: 20px;">
                    <button class="btn" id="saveProfileBtn">ä¿å­˜</button>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿çª—å£ -->
        <div class="window" id="controlPanelWindow" style="top: 150px; left: 300px; width: 400px; display: none;">
            <div class="window-header">
                <div class="window-title">æ§åˆ¶é¢æ¿</div>
                <div class="close-btn" id="closeControlPanel">Ã—</div>
            </div>
            <div class="window-content">
                <h3>ç³»ç»Ÿè®¾ç½®</h3>
                <div class="checkbox-container">
                    <label class="checkbox-label">
                        <input type="checkbox" class="hidden-checkbox" id="autoUpdateCheck">
                        <span class="fake-checkbox"></span>
                        è‡ªåŠ¨å®‰è£…æ›´æ–°
                    </label>
                </div>
                
                <div class="checkbox-container">
                    <label class="checkbox-label">
                        <input type="checkbox" class="hidden-checkbox" id="firewallCheck" checked>
                        <span class="fake-checkbox"></span>
                        å¯ç”¨é˜²ç«å¢™
                    </label>
                </div>
                
                <div id="firewallStatus" class="firewall-status firewall-on">
                    é˜²ç«å¢™çŠ¶æ€: å·²å¯ç”¨
                </div>
                
                <h3>æ˜¾ç¤ºè®¾ç½®</h3>
                <div style="margin: 10px 0;">
                    <label>åˆ†è¾¨ç‡: <span id="resolutionValue">1024x768</span></label>
                    <div style="margin-top: 5px;">
                        <button class="btn" id="decreaseResBtn">é™ä½</button>
                        <button class="btn" id="increaseResBtn">æé«˜</button>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn" id="applySettingsBtn">åº”ç”¨</button>
                </div>
            </div>
        </div>
        
        <!-- æ‰«é›·æ¸¸æˆ -->
        <div class="minesweeper" id="minesweeper">
            <div class="minesweeper-header">
                <div>æ‰«é›·</div>
                <div class="close-btn" id="closeMinesweeper">Ã—</div>
            </div>
            <div style="background: #c0c0c0; padding: 10px; margin-bottom: 10px; display: flex; justify-content: space-between;">
                <div>å‰©ä½™: <span id="minesCount">10</span></div>
                <button class="btn" id="restartMinesweeper">é‡æ–°å¼€å§‹</button>
                <div>æ—¶é—´: <span id="gameTime">0</span>ç§’</div>
            </div>
            <div class="minesweeper-grid" id="minesweeperGrid">
                <!-- æ‰«é›·ç½‘æ ¼é€šè¿‡JSç”Ÿæˆ -->
            </div>
            <div style="margin-top: 10px; text-align: center;">
                <button class="btn" id="showPatternBtn">æ˜¾ç¤ºå½©è›‹</button>
            </div>
        </div>
        
        <!-- ä»»åŠ¡ç®¡ç†å™¨çª—å£ -->
        <div class="window" id="taskManagerWindow" style="top: 150px; left: 350px; width: 400px; display: none;">
            <div class="window-header">
                <div class="window-title">Windows ä»»åŠ¡ç®¡ç†å™¨</div>
                <div class="close-btn" id="closeTaskManager">Ã—</div>
            </div>
            <div class="window-content">
                <div style="display: flex; margin-bottom: 10px;">
                    <button class="btn" id="tmApplicationsBtn">åº”ç”¨ç¨‹åº</button>
                    <button class="btn" id="tmProcessesBtn">è¿›ç¨‹</button>
                    <button class="btn" id="tmPerformanceBtn">æ€§èƒ½</button>
                </div>
                
                <div id="tmApplications">
                    <h3>æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº</h3>
                    <ul class="task-manager-list" id="tmAppList">
                        <!-- åº”ç”¨ç¨‹åºåˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </ul>
                    <div style="text-align: right; margin-top: 10px;">
                        <button class="btn" id="endTaskBtn">ç»“æŸä»»åŠ¡</button>
                        <button class="btn" id="switchToBtn">åˆ‡æ¢è‡³</button>
                    </div>
                </div>
                
                <div id="tmProcesses" style="display: none;">
                    <h3>è¿›ç¨‹</h3>
                    <div style="margin-bottom: 10px;">
                        <input type="text" id="processFilter" placeholder="ç­›é€‰è¿›ç¨‹..." style="width: 100%; padding: 5px;">
                    </div>
                    <ul class="task-manager-list" id="tmProcessList">
                        <!-- è¿›ç¨‹åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </ul>
                    <div style="text-align: right; margin-top: 10px;">
                        <button class="btn" id="endProcessBtn">ç»“æŸè¿›ç¨‹</button>
                    </div>
                </div>
                
                <div id="tmPerformance" style="display: none;">
                    <h3>æ€§èƒ½</h3>
                    <div style="margin: 10px 0;">
                        <div>CPU ä½¿ç”¨: <span id="cpuUsage">15%</span></div>
                        <div class="progress-bar" style="height: 10px;">
                            <div class="progress-fill" style="width: 15%; background: #3a6ea5;"></div>
                        </div>
                    </div>
                    <div style="margin: 10px 0;">
                        <div>å†…å­˜ä½¿ç”¨: <span id="memUsage">512MB / 1024MB</span></div>
                        <div class="progress-bar" style="height: 10px;">
                            <div class="progress-fill" style="width: 50%; background: #3a6ea5;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å‘½ä»¤è¡Œçª—å£ -->
        <div class="window" id="cmdWindow" style="top: 150px; left: 350px; width: 500px; display: none;">
            <div class="window-header">
                <div class="window-title">å‘½ä»¤æç¤ºç¬¦</div>
                <div class="close-btn" id="closeCmd">Ã—</div>
            </div>
            <div class="window-content" style="padding: 0;">
                <div class="cmd-window" id="cmdOutput">
                    Microsoft Windows XP [ç‰ˆæœ¬ 5.1.2600]<br>
                    (C) ç‰ˆæƒæ‰€æœ‰ 1985-2001 Microsoft Corp.<br><br>
                    C:\&gt;
                </div>
                <div class="cmd-input">
                    <span class="cmd-prompt">C:\&gt;</span>
                    <input type="text" class="cmd-input-field" id="cmdInput" autocomplete="off">
                </div>
            </div>
        </div>
        
        <!-- å…³æœºç”»é¢ -->
        <div class="shutdown-screen" id="shutdownScreen">
            <h1>é»‘å¸½æŒ‘æˆ˜èµ›</h1>
            <p>éšè—ç»“å±€ - æ‚¨é€‰æ‹©äº†æå‰å…³æœº</p>
            <p>è¿™ä¸ªéšè—ç»“å±€åªæœ‰çœŸæ­£çš„é»‘å®¢æ‰èƒ½å‘ç°ï¼</p>
            <p>æ‚¨è·å¾—äº† <span style="color: gold;">é»‘å®¢å½©è›‹æˆå°±</span></p>
            <p>å·²å®‰è£…è½¯ä»¶: <span id="installedBeforeShutdown">0</span>/8</p>
            <p>å‰©ä½™é‡‘å¸: <span id="coinsBeforeShutdown">50</span></p>
            <div style="margin-top: 30px;">
                <button class="btn" id="restartAfterShutdown" style="background: #0a246a; color: white; padding: 10px 30px; font-size: 18px;">é‡æ–°å¼€å§‹æ¸¸æˆ</button>
            </div>
        </div>
        
        <!-- é€šå…³ç»“å±€ç”»é¢ -->
        <div class="ending-screen" id="endingScreen">
            <div class="ending-content">
                <h1>æŒ‘æˆ˜æˆåŠŸï¼</h1>
                <p>æ­å–œæ‚¨å®Œæˆäº†é»‘å¸½æŒ‘æˆ˜èµ›çš„æ‰€æœ‰ä»»åŠ¡ï¼</p>
                <p>æ‚¨æˆåŠŸå®‰è£…äº†æ‰€æœ‰8ä¸ªè½¯ä»¶ï¼Œå±•ç¤ºäº†å“è¶Šçš„æŠ€æœ¯èƒ½åŠ›</p>
                
                <div class="ending-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="endingCoins">50</div>
                        <div class="stat-label">è·å¾—é‡‘å¸</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="endingViruses">0</div>
                        <div class="stat-label">æ£€æµ‹åˆ°ç—…æ¯’</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="endingTime">0</div>
                        <div class="stat-label">åˆ†é’Ÿå®Œæˆ</div>
                    </div>
                </div>
                
                <p>æ‚¨è¯æ˜äº†è‡ªå·±æ˜¯ä¸€åçœŸæ­£çš„è½¯ä»¶å®‰è£…å¤§å¸ˆï¼</p>
                <div style="margin-top: 30px;">
                    <button class="btn" id="restartAfterEnding" style="background: #ffcc00; color: #000; padding: 10px 30px; font-size: 18px; font-weight: bold;">å†ç©ä¸€æ¬¡</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            coins: 50,
            currentStep: 0,
            installedViruses: 0,
            history: [],
            installedSoftware: [], // æ–°å¢ï¼šå·²å®‰è£…çš„è½¯ä»¶IDåˆ—è¡¨
            debugMode: false, // æ–°å¢ï¼šè°ƒè¯•æ¨¡å¼çŠ¶æ€
            currentInstallation: {
                options: [],
                selectedOptions: [],
                name: "",
                id: 0,
                requiredOptions: []
            },
            installations: [
                {
                    id: 1,
                    name: "ç³»ç»Ÿä¼˜åŒ–å¤§å¸ˆ",
                    description: "æå‡ç³»ç»Ÿæ€§èƒ½çš„å·¥å…·å¥—ä»¶",
                    requiredOptions: [1],
                    sender: "tech_support@systemtools.com",
                    subject: "æ‚¨è¯·æ±‚çš„ç³»ç»Ÿä¼˜åŒ–å·¥å…·",
                    folder: "inbox",
                    icon: "fa-tools"
                },
                {
                    id: 2,
                    name: "MediaMax æ’­æ”¾å™¨",
                    description: "ä¸‡èƒ½åª’ä½“æ’­æ”¾å™¨",
                    requiredOptions: [1],
                    sender: "media_sales@downloads.com",
                    subject: "æ‚¨çš„åª’ä½“æ’­æ”¾å™¨å®‰è£…åŒ…",
                    folder: "inbox",
                    icon: "fa-play-circle"
                },
                {
                    id: 3,
                    name: "WebSurf Pro æµè§ˆå™¨",
                    description: "é«˜çº§ç½‘é¡µæµè§ˆå™¨",
                    requiredOptions: [1, 4],
                    sender: "browser_dev@websurf.com",
                    subject: "WebSurf Pro å®‰è£…ç¨‹åº",
                    folder: "inbox",
                    icon: "fa-globe"
                },
                {
                    id: 4,
                    name: "FileZipper å‹ç¼©å·¥å…·",
                    description: "æ–‡ä»¶å‹ç¼©ä¸è§£å‹å·¥å…·",
                    requiredOptions: [1, 3],
                    sender: "file_utils@compression.com",
                    subject: "FileZipper 2005 å®‰è£…åŒ…",
                    folder: "inbox",
                    icon: "fa-file-archive"
                },
                {
                    id: 5,
                    name: "å®‰å…¨é˜²æŠ¤ç›¾",
                    description: "ç³»ç»Ÿå®‰å…¨é˜²æŠ¤è½¯ä»¶",
                    requiredOptions: [1],
                    sender: "security@defenders.org",
                    subject: "æ‚¨è¯·æ±‚çš„å®‰å…¨è½¯ä»¶",
                    folder: "inbox",
                    icon: "fa-shield-alt"
                },
                {
                    id: 6,
                    name: "æ–‡æ¡£ç¼–è¾‘å™¨ Pro",
                    description: "é«˜çº§æ–‡æ¡£å¤„ç†å·¥å…·",
                    requiredOptions: [1],
                    sender: "office_tools@productivity.com",
                    subject: "æ–‡æ¡£ç¼–è¾‘å™¨å®‰è£…åŒ…",
                    folder: "inbox",
                    icon: "fa-file-word"
                },
                {
                    id: 7,
                    name: "ç½‘ç»œåŠ é€Ÿå™¨",
                    description: "æå‡ç½‘ç»œè¿æ¥é€Ÿåº¦",
                    requiredOptions: [1],
                    sender: "net_speed@optimizers.com",
                    subject: "ç½‘ç»œåŠ é€Ÿè§£å†³æ–¹æ¡ˆ",
                    folder: "inbox",
                    icon: "fa-bolt"
                },
                {
                    id: 8,
                    name: "ç»ˆææ¸…ç†å·¥å…·",
                    description: "ç³»ç»Ÿæ¸…ç†ä¸ç»´æŠ¤",
                    requiredOptions: [1],
                    sender: "sys_clean@maintenance.com",
                    subject: "æ‚¨çš„ç³»ç»Ÿæ¸…ç†å·¥å…·",
                    folder: "inbox",
                    icon: "fa-broom"
                }
            ],
            sentMails: [
                {
                    id: 101,
                    recipient: "tech_support@systemtools.com",
                    subject: "å…³äºç³»ç»Ÿä¼˜åŒ–å·¥å…·çš„å’¨è¯¢",
                    folder: "sent"
                },
                {
                    id: 102,
                    recipient: "security@defenders.org",
                    subject: "å®‰å…¨è½¯ä»¶è¯•ç”¨è¯·æ±‚",
                    folder: "sent"
                }
            ],
            currentInstallIndex: 0,
            installedCount: 0,
            activePopups: [],
            easterEggsFound: 0,
            totalVirusesInstalled: 0,
            currentMailPage: 1,
            mailsPerPage: 5,
            playerName: "æŒ‘æˆ˜è€…",
            blackhatName: "é»‘å¸½é»‘å®¢",
            challengeActive: true,
            currentMailFolder: "inbox",
            selectedMailId: null,
            startTime: new Date(),
            firewallEnabled: true,
            resolution: 0, // 0:1024x768, 1:1280x720, 2:1366x768
            resolutions: ["1024x768", "1280x720", "1366x768"],
            desktopShortcuts: [],
            trashItems: [
                { name: "old_document.txt", size: "2.3 MB", date: "2023-10-15" },
                { name: "temp_file.tmp", size: "0.5 MB", date: "2023-10-16" },
                { name: "unused_program.exe", size: "12.4 MB", date: "2023-10-17" }
            ],
            minesweeperPattern: [3, 9, 10, 11, 15, 16, 17, 21, 22, 23, 27, 33, 39, 45], // ç¬‘è„¸å›¾æ¡ˆ
            currentFolder: "root",
            openWindows: [],
            runningProcesses: [
                { id: 1, name: "explorer.exe", cpu: 2, memory: 45 },
                { id: 2, name: "taskmgr.exe", cpu: 1, memory: 15 },
                { id: 3, name: "chrome.exe", cpu: 5, memory: 120 },
                { id: 4, name: "winword.exe", cpu: 3, memory: 80 }
            ],
            fileSystem: {
                root: {
                    name: "æˆ‘çš„ç”µè„‘",
                    type: "folder",
                    items: [
                        { name: "æœ¬åœ°ç£ç›˜ (C:)", path: "C:/", type: "drive" },
                        { name: "æœ¬åœ°ç£ç›˜ (D:)", path: "D:/", type: "drive" },
                        { name: "æˆ‘çš„æ–‡æ¡£", path: "Documents", type: "folder" },
                        { name: "ä¸‹è½½", path: "Downloads", type: "folder" },
                        { name: "æ¡Œé¢", path: "Desktop", type: "folder" }
                    ]
                },
                "C:/": {
                    name: "æœ¬åœ°ç£ç›˜ (C:)",
                    type: "drive",
                    items: [
                        { name: "Windows", path: "C:/Windows", type: "folder" },
                        { name: "Program Files", path: "C:/Program Files", type: "folder" },
                        { name: "Documents and Settings", path: "C:/Documents and Settings", type: "folder" },
                        { name: "boot.ini", type: "file", size: "0.2 KB" },
                        { name: "pagefile.sys", type: "file", size: "1.2 GB" }
                    ]
                },
                "Documents": {
                    name: "æˆ‘çš„æ–‡æ¡£",
                    type: "folder",
                    items: [
                        { name: "æŠ¥å‘Š.doc", type: "file", size: "1.2 MB" },
                        { name: "ç®€å†.pdf", type: "file", size: "0.8 MB" },
                        { name: "å›¾ç‰‡", path: "Documents/Pictures", type: "folder" },
                        { name: "éŸ³ä¹", path: "Documents/Music", type: "folder" }
                    ]
                },
                "Downloads": {
                    name: "ä¸‹è½½",
                    type: "folder",
                    items: [
                        { name: "setup.exe", type: "file", size: "15.4 MB" },
                        { name: "manual.pdf", type: "file", size: "3.2 MB" },
                        { name: "patch.zip", type: "file", size: "7.8 MB" }
                    ]
                }
            },
            explorerHistory: [],
            currentExplorerPath: "root"
        };
        
        // DOMå…ƒç´ 
        const elements = {
            mailIcon: document.getElementById('mailIcon'),
            mailWindow: document.getElementById('mailWindow'),
            mailViewWindow: document.getElementById('mailViewWindow'),
            mailViewContent: document.getElementById('mailViewContent'),
            mailList: document.getElementById('mailList'),
            installWindow: document.getElementById('installWindow'),
            installContent: document.getElementById('installContent'),
            resultWindow: document.getElementById('resultWindow'),
            resultContent: document.getElementById('resultContent'),
            downloadBtn: document.getElementById('downloadBtn'),
            closeMail: document.getElementById('closeMail'),
            closeMailView: document.getElementById('closeMailView'),
            closeInstall: document.getElementById('closeInstall'),
            closeResult: document.getElementById('closeResult'),
            coinsDisplay: document.getElementById('coinsCount'),
            notification: document.getElementById('notification'),
            historyBtn: document.getElementById('historyBtn'),
            timeDisplay: document.getElementById('timeDisplay'),
            popupAd: document.getElementById('popupAd'),
            closeAd: document.getElementById('closeAd'),
            downloadAdBtn: document.getElementById('downloadAdBtn'),
            ransomWindow: document.getElementById('ransomWindow'),
            closeRansom: document.getElementById('closeRansom'),
            payRansomBtn: document.getElementById('payRansomBtn'),
            ignoreRansomBtn: document.getElementById('ignoreRansomBtn'),
            countdown: document.getElementById('countdown'),
            mailTask: document.getElementById('mailTask'),
            installTask: document.getElementById('installTask'),
            virusNotice: document.getElementById('virusNotice'),
            virusCount: document.getElementById('virusCount'),
            desktop: document.getElementById('desktop'),
            myComputer: document.getElementById('myComputer'),
            recycleBin: document.getElementById('recycleBin'),
            myComputerWindow: document.getElementById('myComputerWindow'),
            recycleBinWindow: document.getElementById('recycleBinWindow'),
            closeMyComputer: document.getElementById('closeMyComputer'),
            closeRecycleBin: document.getElementById('closeRecycleBin'),
            emptyBinBtn: document.getElementById('emptyBinBtn'),
            restoreAllBtn: document.getElementById('restoreAllBtn'),
            startBtn: document.getElementById('startBtn'),
            startMenu: document.getElementById('startMenu'),
            closeStartMenu: document.getElementById('closeStartMenu'),
            inboxBtn: document.getElementById('inboxBtn'),
            sentBtn: document.getElementById('sentBtn'),
            newMailBtn: document.getElementById('newMailBtn'),
            deleteMailBtn: document.getElementById('deleteMailBtn'),
            prevPageBtn: document.getElementById('prevPageBtn'),
            nextPageBtn: document.getElementById('nextPageBtn'),
            page1Btn: document.getElementById('page1Btn'),
            page2Btn: document.getElementById('page2Btn'),
            playerName: document.getElementById('playerName'),
            coinsInPC: document.getElementById('coinsInPC'),
            shutdownScreen: document.getElementById('shutdownScreen'),
            installedBeforeShutdown: document.getElementById('installedBeforeShutdown'),
            coinsBeforeShutdown: document.getElementById('coinsBeforeShutdown'),
            restartAfterShutdown: document.getElementById('restartAfterShutdown'),
            profileItem: document.getElementById('profileItem'),
            mailClientItem: document.getElementById('mailClientItem'),
            gamesItem: document.getElementById('gamesItem'),
            controlPanelItem: document.getElementById('controlPanelItem'),
            taskManagerItem: document.getElementById('taskManagerItem'),
            cmdItem: document.getElementById('cmdItem'),
            shutdownItem: document.getElementById('shutdownItem'),
            profileWindow: document.getElementById('profileWindow'),
            controlPanelWindow: document.getElementById('controlPanelWindow'),
            closeProfile: document.getElementById('closeProfile'),
            closeControlPanel: document.getElementById('closeControlPanel'),
            playerNameInput: document.getElementById('playerNameInput'),
            installedCountProfile: document.getElementById('installedCountProfile'),
            coinsProfile: document.getElementById('coinsProfile'),
            virusesProfile: document.getElementById('virusesProfile'),
            saveProfileBtn: document.getElementById('saveProfileBtn'),
            endingScreen: document.getElementById('endingScreen'),
            endingCoins: document.getElementById('endingCoins'),
            endingViruses: document.getElementById('endingViruses'),
            endingTime: document.getElementById('endingTime'),
            restartAfterEnding: document.getElementById('restartAfterEnding'),
            contextMenu: document.getElementById('contextMenu'),
            newFolderItem: document.getElementById('newFolderItem'),
            shortcutItem: document.getElementById('shortcutItem'),
            refreshItem: document.getElementById('refreshItem'),
            propertiesItem: document.getElementById('propertiesItem'),
            minesweeper: document.getElementById('minesweeper'),
            closeMinesweeper: document.getElementById('closeMinesweeper'),
            minesweeperGrid: document.getElementById('minesweeperGrid'),
            restartMinesweeper: document.getElementById('restartMinesweeper'),
            minesCount: document.getElementById('minesCount'),
            gameTime: document.getElementById('gameTime'),
            showPatternBtn: document.getElementById('showPatternBtn'),
            firewallCheck: document.getElementById('firewallCheck'),
            autoUpdateCheck: document.getElementById('autoUpdateCheck'),
            decreaseResBtn: document.getElementById('decreaseResBtn'),
            increaseResBtn: document.getElementById('increaseResBtn'),
            resolutionValue: document.getElementById('resolutionValue'),
            applySettingsBtn: document.getElementById('applySettingsBtn'),
            firewallStatus: document.getElementById('firewallStatus'),
            trashCount: document.getElementById('trashCount'),
            trashItems: document.getElementById('trashItems'),
            shutdownOverlay: document.getElementById('shutdownOverlay'),
            taskManagerWindow: document.getElementById('taskManagerWindow'),
            closeTaskManager: document.getElementById('closeTaskManager'),
            tmApplicationsBtn: document.getElementById('tmApplicationsBtn'),
            tmProcessesBtn: document.getElementById('tmProcessesBtn'),
            tmPerformanceBtn: document.getElementById('tmPerformanceBtn'),
            tmAppList: document.getElementById('tmAppList'),
            tmProcessList: document.getElementById('tmProcessList'),
            endTaskBtn: document.getElementById('endTaskBtn'),
            endProcessBtn: document.getElementById('endProcessBtn'),
            cmdWindow: document.getElementById('cmdWindow'),
            closeCmd: document.getElementById('closeCmd'),
            cmdOutput: document.getElementById('cmdOutput'),
            cmdInput: document.getElementById('cmdInput'),
            backBtn: document.getElementById('backBtn'),
            forwardBtn: document.getElementById('forwardBtn'),
            upBtn: document.getElementById('upBtn'),
            breadcrumb: document.getElementById('breadcrumb'),
            folderPane: document.getElementById('folderPane'),
            filePane: document.getElementById('filePane'),
            debugToggle: document.getElementById('debugToggle') // æ–°å¢ï¼šè°ƒè¯•æ¨¡å¼å¼€å…³
        };
        
        // å®‰è£…æ­¥éª¤é…ç½®
        const installationSteps = {
            1: [
                {
                    title: "æ¬¢è¿ä½¿ç”¨ ç³»ç»Ÿä¼˜åŒ–å¤§å¸ˆ å®‰è£…å‘å¯¼",
                    content: "æœ¬å‘å¯¼å°†å¼•å¯¼æ‚¨å®Œæˆç³»ç»Ÿä¼˜åŒ–å¤§å¸ˆçš„å®‰è£…è¿‡ç¨‹ã€‚",
                    buttons: [{text: "ä¸‹ä¸€æ­¥ >", action: "next"}],
                    options: []
                },
                {
                    title: "è®¸å¯åè®®",
                    content: "è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹è®¸å¯åè®®ã€‚æ‚¨å¿…é¡»æ¥å—åè®®æ‰èƒ½ç»§ç»­å®‰è£…ã€‚",
                    buttons: [
                        {text: "< ä¸Šä¸€æ­¥", action: "prev"},
                        {text: "æˆ‘æ¥å— >", action: "next", id: "acceptBtn", disabled: true}
                    ],
                    options: [
                        {text: "æˆ‘æ¥å—è®¸å¯åè®®æ¡æ¬¾", type: "checkbox", required: true, virus: false}
                    ],
                    special: "agreement"
                },
                {
                    title: "ä¼˜åŒ–é€‰é¡¹",
                    content: "é€‰æ‹©è¦åº”ç”¨çš„ä¼˜åŒ–é€‰é¡¹ï¼ˆæ¨èå…¨éƒ¨å®‰è£…ä»¥è·å¾—æœ€ä½³ä½“éªŒï¼‰ã€‚",
                    buttons: [
                        {text: "< ä¸Šä¸€æ­¥", action: "prev"},
                        {text: "ä¸‹ä¸€æ­¥ >", action: "next"}
                    ],
                    options: [
                        {text: "å®‰è£…ç³»ç»ŸåŠ é€Ÿæ¨¡å—", type: "checkbox", checked: true, virus: false},
                        {text: "å®‰è£…å†…å­˜ä¼˜åŒ–å·¥å…·", type: "checkbox", checked: true, virus: true},
                        {text: "å®‰è£…æ³¨å†Œè¡¨æ¸…ç†å™¨", type: "checkbox", checked: true, virus: true},
                        {text: "å®‰è£…å¯åŠ¨é¡¹ç®¡ç†å™¨", type: "checkbox", checked: true, virus: false}
                    ]
                },
                {
                    title: "é™„åŠ ç»„ä»¶",
                    content: "é€‰æ‹©è¦å®‰è£…çš„é™„åŠ ç»„ä»¶ã€‚",
                    buttons: [
                        {text: "< ä¸Šä¸€æ­¥", action: "prev"},
                        {text: "ä¸‹ä¸€æ­¥ >", action: "next"}
                    ],
                    options: [
                        {text: "åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼", type: "checkbox", checked: true, virus: false},
                        {text: "å®‰è£…æ€§èƒ½ç›‘è§†å™¨", type: "checkbox", checked: true, virus: false},
                        {text: "å®‰è£…é«˜çº§è¯Šæ–­å·¥å…·", type: "checkbox", checked: true, virus: true}
                    ]
                },
                {
                    title: "å‡†å¤‡å®‰è£…",
                    content: "å®‰è£…ç¨‹åºå·²å‡†å¤‡å¥½å¼€å§‹å®‰è£…ç³»ç»Ÿä¼˜åŒ–å¤§å¸ˆã€‚",
                    buttons: [
                        {text: "< ä¸Šä¸€æ­¥", action: "prev"},
                        {text: "å®‰è£…", action: "install"}
                    ],
                    options: []
                },
                {
                    title: "æ­£åœ¨å®‰è£…",
                    content: "æ­£åœ¨å®‰è£…ç³»ç»Ÿä¼˜åŒ–å¤§å¸ˆï¼Œè¯·ç¨å€™...",
                    buttons: [],
                    options: []
                },
                {
                    title: "å®‰è£…å®Œæˆ",
                    content: "ç³»ç»Ÿä¼˜åŒ–å¤§å¸ˆå·²æˆåŠŸå®‰è£…åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šã€‚",
                    buttons: [
                        {text: "å®Œæˆ", action: "finish"}
                    ],
                    options: [
                        {text: "è¿è¡Œç³»ç»Ÿä¼˜åŒ–å¤§å¸ˆ", type: "checkbox", checked: true, virus: false},
                        {text: "å®‰è£…ç³»ç»Ÿæ¸…ç†å·¥å…·", type: "checkbox", checked: true, virus: true},
                        {text: "æŸ¥çœ‹ä¼˜åŒ–æŠ¥å‘Š", type: "checkbox", checked: true, virus: false}
                    ]
                }
            ],
            2: [
                {
                    title: "MediaMax Player å®‰è£…",
                    content: "æ¬¢è¿ä½¿ç”¨æœ€å¼ºå¤§çš„åª’ä½“æ’­æ”¾å™¨å®‰è£…ç¨‹åº",
                    buttons: [{text: "ä¸‹ä¸€æ­¥ >", action: "next"}],
                    options: []
                },
                {
                    title: "è®¸å¯åè®®",
                    content: "è¯·é˜…è¯»å¹¶æ¥å—è®¸å¯åè®®",
                    buttons: [
                        {text: "< ä¸Šä¸€æ­¥", action: "prev"},
                        {text: "æˆ‘æ¥å— >", action: "next", id: "acceptBtn", disabled: true}
                    ],
                    options: [
                        {text: "æˆ‘æ¥å—è®¸å¯åè®®æ¡æ¬¾", type: "checkbox", required: true, virus: false}
                    ],
                    special: "agreement"
                },
                {
                    title: "åª’ä½“æ”¯æŒ",
                    content: "é€‰æ‹©è¦æ”¯æŒçš„åª’ä½“æ ¼å¼",
                    buttons: [
                        {text: "< ä¸Šä¸€æ­¥", action: "prev"},
                        {text: "ä¸‹ä¸€æ­¥ >", action: "next"}
                    ],
                    options: [
                        {text: "æ”¯æŒMP3, MP4æ ¼å¼", type: "checkbox", checked: true, virus: false},
                        {text: "æ”¯æŒAVI, MKVæ ¼å¼", type: "checkbox", checked: true, virus: false},
                        {text: "å®‰è£…é«˜çº§ç¼–è§£ç å™¨åŒ…", type: "checkbox", checked: true, virus: true}
                    ]
                },
                {
                    title: "é¢å¤–åŠŸèƒ½",
                    content: "é€‰æ‹©è¦å®‰è£…çš„é¢å¤–åŠŸèƒ½",
                    buttons: [
                        {text: "< ä¸Šä¸€æ­¥", action: "prev"},
                        {text: "ä¸‹ä¸€æ­¥ >", action: "next"}
                    ],
                    options: [
                        {text: "åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼", type: "checkbox", checked: true, virus: false},
                        {text: "å®‰è£…åª’ä½“åº“ç®¡ç†å™¨", type: "checkbox", checked: true, virus: false},
                        {text: "å®‰è£…åœ¨çº¿è§†é¢‘ä¸‹è½½å™¨", type: "checkbox", checked: true, virus: true}
                    ]
                },
                {
                    title: "å‡†å¤‡å®‰è£…",
                    content: "å‡†å¤‡å®‰è£… MediaMax Player",
                    buttons: [
                        {text: "< ä¸Šä¸€æ­¥", action: "prev"},
                        {text: "å®‰è£…", action: "install"}
                    ],
                    options: []
                },
                {
                    title: "æ­£åœ¨å®‰è£…",
                    content: "æ­£åœ¨å®‰è£… MediaMax Playerï¼Œè¯·ç¨å€™...",
                    buttons: [],
                    options: []
                },
                {
                    title: "å®‰è£…å®Œæˆ",
                    content: "MediaMax Player å·²æˆåŠŸå®‰è£…",
                    buttons: [
                        {text: "å®Œæˆ", action: "finish"}
                    ],
                    options: [
                        {text: "è¿è¡Œ MediaMax Player", type: "checkbox", checked: true, virus: false},
                        {text: "å®‰è£…åª’ä½“è½¬æ¢å·¥å…·", type: "checkbox", checked: true, virus: true},
                        {text: "è®¢é˜…åª’ä½“æ›´æ–°æœåŠ¡", type: "checkbox", checked: true, virus: false}
                    ]
                }
            ]
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // æ˜¾ç¤ºæ–°é‚®ä»¶é€šçŸ¥
            elements.notification.style.display = 'block';
            
            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            updateTime();
            setInterval(updateTime, 60000);
            
            // ç»‘å®šäº‹ä»¶
            elements.mailIcon.addEventListener('click', openMail);
            elements.closeMail.addEventListener('click', closeMail);
            elements.closeMailView.addEventListener('click', closeMailView);
            elements.closeInstall.addEventListener('click', closeInstall);
            elements.closeResult.addEventListener('click', closeResult);
            elements.historyBtn.addEventListener('click', goBackInHistory);
            elements.closeAd.addEventListener('click', closePopupAd);
            elements.downloadAdBtn.addEventListener('click', downloadAdSoftware);
            elements.closeRansom.addEventListener('click', closeRansom);
            elements.payRansomBtn.addEventListener('click', payRansom);
            elements.ignoreRansomBtn.addEventListener('click', ignoreRansom);
            elements.mailTask.addEventListener('click', openMail);
            elements.installTask.addEventListener('click', openInstall);
            elements.myComputer.addEventListener('click', openMyComputer);
            elements.recycleBin.addEventListener('click', openRecycleBin);
            elements.closeMyComputer.addEventListener('click', closeMyComputer);
            elements.closeRecycleBin.addEventListener('click', closeRecycleBin);
            elements.emptyBinBtn.addEventListener('click', emptyRecycleBin);
            elements.restoreAllBtn.addEventListener('click', restoreAllRecycleBin);
            elements.startBtn.addEventListener('click', toggleStartMenu);
            elements.closeStartMenu.addEventListener('click', closeStartMenu);
            elements.inboxBtn.addEventListener('click', () => setMailFolder('inbox'));
            elements.sentBtn.addEventListener('click', () => setMailFolder('sent'));
            elements.newMailBtn.addEventListener('click', newMail);
            elements.deleteMailBtn.addEventListener('click', deleteMail);
            elements.prevPageBtn.addEventListener('click', () => changeMailPage(-1));
            elements.nextPageBtn.addEventListener('click', () => changeMailPage(1));
            elements.page1Btn.addEventListener('click', () => setMailPage(1));
            elements.page2Btn.addEventListener('click', () => setMailPage(2));
            elements.restartAfterShutdown.addEventListener('click', () => location.reload());
            elements.restartAfterEnding.addEventListener('click', () => location.reload());
            
            // å¼€å§‹èœå•åŠŸèƒ½
            elements.profileItem.addEventListener('click', openProfile);
            elements.mailClientItem.addEventListener('click', openMail);
            elements.gamesItem.addEventListener('click', openMinesweeper);
            elements.controlPanelItem.addEventListener('click', openControlPanel);
            elements.taskManagerItem.addEventListener('click', openTaskManager);
            elements.cmdItem.addEventListener('click', openCmd);
            elements.shutdownItem.addEventListener('click', shutdownComputer);
            
            // ç©å®¶æ¡£æ¡ˆåŠŸèƒ½
            elements.closeProfile.addEventListener('click', closeProfile);
            elements.saveProfileBtn.addEventListener('click', saveProfile);
            
            // æ§åˆ¶é¢æ¿åŠŸèƒ½
            elements.closeControlPanel.addEventListener('click', closeControlPanel);
            elements.firewallCheck.addEventListener('change', toggleFirewall);
            elements.autoUpdateCheck.addEventListener('change', toggleAutoUpdate);
            elements.decreaseResBtn.addEventListener('click', decreaseResolution);
            elements.increaseResBtn.addEventListener('click', increaseResolution);
            elements.applySettingsBtn.addEventListener('click', applySettings);
            
            // å³é”®èœå•åŠŸèƒ½
            elements.desktop.addEventListener('contextmenu', showContextMenu);
            elements.desktop.addEventListener('click', hideContextMenu);
            elements.newFolderItem.addEventListener('click', createNewFolder);
            elements.shortcutItem.addEventListener('click', createShortcut);
            elements.refreshItem.addEventListener('click', refreshDesktop);
            elements.propertiesItem.addEventListener('click', showProperties);
            
            // æ‰«é›·æ¸¸æˆåŠŸèƒ½
            elements.closeMinesweeper.addEventListener('click', closeMinesweeper);
            elements.restartMinesweeper.addEventListener('click', initMinesweeper);
            elements.showPatternBtn.addEventListener('click', showMinesweeperPattern);
            
            // å›æ”¶ç«™åŠŸèƒ½ - ä½¿ç”¨äº‹ä»¶å§”æ‰˜
            elements.trashItems.addEventListener('click', function(e) {
                if (e.target.classList.contains('restore-item')) {
                    restoreItem(e);
                }
            });
            
            // ä»»åŠ¡ç®¡ç†å™¨åŠŸèƒ½
            elements.closeTaskManager.addEventListener('click', closeTaskManager);
            elements.tmApplicationsBtn.addEventListener('click', () => showTaskManagerTab('tmApplications'));
            elements.tmProcessesBtn.addEventListener('click', () => showTaskManagerTab('tmProcesses'));
            elements.tmPerformanceBtn.addEventListener('click', () => showTaskManagerTab('tmPerformance'));
            elements.endTaskBtn.addEventListener('click', endTask);
            elements.endProcessBtn.addEventListener('click', endProcess);
            
            // å‘½ä»¤è¡ŒåŠŸèƒ½
            elements.closeCmd.addEventListener('click', closeCmd);
            elements.cmdInput.addEventListener('keydown', handleCmdInput);
            
            // æ–‡ä»¶æµè§ˆå™¨åŠŸèƒ½
            elements.backBtn.addEventListener('click', goBackInExplorer);
            elements.forwardBtn.addEventListener('click', goForwardInExplorer);
            elements.upBtn.addEventListener('click', goUpInExplorer);
            
            // ç»‘å®šå½©è›‹äº‹ä»¶
            document.querySelectorAll('.easter-egg').forEach(egg => {
                egg.addEventListener('click', findEasterEgg);
            });
            
            // åˆå§‹åŒ–çª—å£æ‹–åŠ¨
            initWindowDrag();
            
            // åˆå§‹åŒ–æ‰«é›·æ¸¸æˆ
            initMinesweeper();
            
            // åˆå§‹åŒ–æ–‡ä»¶æµè§ˆå™¨
            renderFolderView('root');
            renderRecycleBin();
            
            // ç»‘å®šè°ƒè¯•æ¨¡å¼åˆ‡æ¢äº‹ä»¶
            elements.debugToggle.addEventListener('click', toggleDebugMode);
            
            // ç»‘å®šé”®ç›˜äº‹ä»¶ç›‘å¬è°ƒè¯•æ¨¡å¼
            document.addEventListener('keydown', handleKeyDown);
            
            updateCoinsDisplay();
            renderMailList();
            updateTrashDisplay();
            renderTaskManagerApps();
            renderTaskManagerProcesses();
        }
        
        // åˆ‡æ¢è°ƒè¯•æ¨¡å¼
        function toggleDebugMode() {
            gameState.debugMode = !gameState.debugMode;
            elements.debugToggle.textContent = `è°ƒè¯•æ¨¡å¼: ${gameState.debugMode ? "å¼€" : "å…³"}`;
            elements.debugToggle.style.backgroundColor = gameState.debugMode ? "#33cc33" : "#ffcc00";
            
            // é‡æ–°æ¸²æŸ“å®‰è£…æ­¥éª¤ï¼ˆå¦‚æœæ­£åœ¨å®‰è£…ï¼‰
            if (elements.installWindow.style.display === 'block') {
                renderInstallationStep();
            }
        }
        
        // å¤„ç†é”®ç›˜äº‹ä»¶
        function handleKeyDown(e) {
            // Ctrl+Shift+D åˆ‡æ¢è°ƒè¯•æ¨¡å¼
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                toggleDebugMode();
                e.preventDefault();
            }
        }
        
        // æ¸²æŸ“å›æ”¶ç«™å†…å®¹
        function renderRecycleBin() {
            let html = '';
            gameState.trashItems.forEach((item, index) => {
                html += `
                    <div class="trash-item">
                        <div class="trash-item-name"><i class="fas fa-file"></i> ${item.name}</div>
                        <div class="trash-item-date">${item.date}</div>
                        <button class="btn action-btn restore-item" data-index="${index}">è¿˜åŸ</button>
                    </div>
                `;
            });
            elements.trashItems.innerHTML = html;
        }
        
        // æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨
        function openTaskManager() {
            elements.taskManagerWindow.style.display = 'block';
            closeStartMenu();
        }
        
        // å…³é—­ä»»åŠ¡ç®¡ç†å™¨
        function closeTaskManager() {
            elements.taskManagerWindow.style.display = 'none';
        }
        
        // æ˜¾ç¤ºä»»åŠ¡ç®¡ç†å™¨æ ‡ç­¾é¡µ
        function showTaskManagerTab(tabId) {
            document.getElementById('tmApplications').style.display = 'none';
            document.getElementById('tmProcesses').style.display = 'none';
            document.getElementById('tmPerformance').style.display = 'none';
            
            document.getElementById(tabId).style.display = 'block';
        }
        
        // æ¸²æŸ“ä»»åŠ¡ç®¡ç†å™¨åº”ç”¨ç¨‹åºåˆ—è¡¨
        function renderTaskManagerApps() {
            let html = '';
            const windows = ['mailWindow', 'installWindow', 'myComputerWindow', 'recycleBinWindow', 'minesweeper'];
            
            windows.forEach(windowId => {
                if (elements[windowId].style.display === 'block') {
                    const title = elements[windowId].querySelector('.window-title').textContent;
                    html += `
                        <li class="task-manager-item" data-window="${windowId}">
                            <div class="task-manager-item-name">${title}</div>
                        </li>
                    `;
                }
            });
            
            elements.tmAppList.innerHTML = html;
        }
        
        // æ¸²æŸ“ä»»åŠ¡ç®¡ç†å™¨è¿›ç¨‹åˆ—è¡¨
        function renderTaskManagerProcesses() {
            let html = '';
            
            gameState.runningProcesses.forEach(process => {
                html += `
                    <li class="task-manager-item" data-process="${process.id}">
                        <div class="task-manager-item-name">${process.name}</div>
                        <div>${process.cpu}%</div>
                        <div>${process.memory}MB</div>
                    </li>
                `;
            });
            
            elements.tmProcessList.innerHTML = html;
        }
        
        // ç»“æŸä»»åŠ¡
        function endTask() {
            const selected = elements.tmAppList.querySelector('.selected');
            if (selected) {
                const windowId = selected.dataset.window;
                elements[windowId].style.display = 'none';
                renderTaskManagerApps();
                alert(`å·²ç»“æŸä»»åŠ¡: ${selected.querySelector('.task-manager-item-name').textContent}`);
            } else {
                alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡ï¼");
            }
        }
        
        // ç»“æŸè¿›ç¨‹
        function endProcess() {
            const selected = elements.tmProcessList.querySelector('.selected');
            if (selected) {
                const processId = parseInt(selected.dataset.process);
                gameState.runningProcesses = gameState.runningProcesses.filter(p => p.id !== processId);
                renderTaskManagerProcesses();
                alert(`å·²ç»“æŸè¿›ç¨‹: ${selected.querySelector('.task-manager-item-name').textContent}`);
            } else {
                alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè¿›ç¨‹ï¼");
            }
        }
        
        // æ‰“å¼€å‘½ä»¤è¡Œ
        function openCmd() {
            elements.cmdWindow.style.display = 'block';
            closeStartMenu();
        }
        
        // å…³é—­å‘½ä»¤è¡Œ
        function closeCmd() {
            elements.cmdWindow.style.display = 'none';
        }
        
        // å¤„ç†å‘½ä»¤è¡Œè¾“å…¥
        function handleCmdInput(e) {
            if (e.key === 'Enter') {
                const command = elements.cmdInput.value.trim();
                elements.cmdInput.value = '';
                
                // æ·»åŠ å‘½ä»¤åˆ°è¾“å‡º
                elements.cmdOutput.innerHTML += `<div>C:\&gt; ${command}</div>`;
                
                // å¤„ç†å‘½ä»¤
                handleCommand(command);
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                elements.cmdOutput.scrollTop = elements.cmdOutput.scrollHeight;
            }
        }
        
        // å¤„ç†å‘½ä»¤
        function handleCommand(command) {
            const cmd = command.toLowerCase().split(' ')[0];
            const args = command.split(' ').slice(1);
            
            switch(cmd) {
                case 'help':
                    elements.cmdOutput.innerHTML += `
                        <div>å¯ç”¨å‘½ä»¤:</div>
                        <div>help - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</div>
                        <div>dir - åˆ—å‡ºå½“å‰ç›®å½•å†…å®¹</div>
                        <div>echo [text] - æ˜¾ç¤ºæ–‡æœ¬</div>
                        <div>cls - æ¸…å±</div>
                        <div>exit - é€€å‡ºå‘½ä»¤è¡Œ</div>
                        <div>ver - æ˜¾ç¤ºç³»ç»Ÿç‰ˆæœ¬</div>
                        <div>date - æ˜¾ç¤ºå½“å‰æ—¥æœŸ</div>
                        <div>time - æ˜¾ç¤ºå½“å‰æ—¶é—´</div>
                    `;
                    break;
                    
                case 'dir':
                    elements.cmdOutput.innerHTML += `
                        <div> é©±åŠ¨å™¨ C ä¸­çš„å·æ˜¯ System</div>
                        <div> å·çš„åºåˆ—å·æ˜¯ 1A2B-3C4D</div><br>
                        <div> C:\\ çš„ç›®å½•</div><br>
                        <div>2023-10-01  10:30 AM    &lt;DIR&gt;          Windows</div>
                        <div>2023-10-01  10:35 AM    &lt;DIR&gt;          Program Files</div>
                        <div>2023-10-01  10:40 AM    &lt;DIR&gt;          Documents</div>
                        <div>2023-10-01  11:15 AM            15,360 boot.ini</div>
                        <div>2023-10-01  11:20 AM     1,073,741,824 pagefile.sys</div>
                        <div>               2 ä¸ªæ–‡ä»¶  1,073,757,184 å­—èŠ‚</div>
                        <div>               3 ä¸ªç›®å½•  2,500,000,000 å¯ç”¨å­—èŠ‚</div>
                    `;
                    break;
                    
                case 'echo':
                    elements.cmdOutput.innerHTML += `<div>${args.join(' ')}</div>`;
                    break;
                    
                case 'cls':
                    elements.cmdOutput.innerHTML = '';
                    break;
                    
                case 'exit':
                    closeCmd();
                    break;
                    
                case 'ver':
                    elements.cmdOutput.innerHTML += `<div>Microsoft Windows XP [ç‰ˆæœ¬ 5.1.2600]</div>`;
                    break;
                    
                case 'date':
                    const now = new Date();
                    const dateStr = now.toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    elements.cmdOutput.innerHTML += `<div>å½“å‰æ—¥æœŸ: ${dateStr}</div>`;
                    break;
                    
                case 'time':
                    const timeStr = new Date().toLocaleTimeString('zh-CN');
                    elements.cmdOutput.innerHTML += `<div>å½“å‰æ—¶é—´: ${timeStr}</div>`;
                    break;
                    
                default:
                    elements.cmdOutput.innerHTML += `<div>'${cmd}' ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚</div>`;
            }
        }
        
        // æ›´æ–°å›æ”¶ç«™æ˜¾ç¤º
        function updateTrashDisplay() {
            elements.trashCount.textContent = gameState.trashItems.length;
        }
        
        // åˆå§‹åŒ–çª—å£æ‹–åŠ¨
        function initWindowDrag() {
            const windows = document.querySelectorAll('.window, .popup-ad');
            windows.forEach(window => {
                const header = window.querySelector('.window-header, .popup-header');
                if (header) {
                    header.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        
                        // æå‡å½“å‰çª—å£çš„z-index
                        windows.forEach(w => w.style.zIndex = "10");
                        window.style.zIndex = "100";
                        
                        const startX = e.clientX;
                        const startY = e.clientY;
                        const startLeft = parseInt(window.style.left) || 0;
                        const startTop = parseInt(window.style.top) || 0;
                        
                        function drag(e) {
                            const dx = e.clientX - startX;
                            const dy = e.clientY - startY;
                            window.style.left = (startLeft + dx) + 'px';
                            window.style.top = (startTop + dy) + 'px';
                        }
                        
                        function stopDrag() {
                            document.removeEventListener('mousemove', drag);
                            document.removeEventListener('mouseup', stopDrag);
                        }
                        
                        document.addEventListener('mousemove', drag);
                        document.addEventListener('mouseup', stopDrag);
                    });
                }
            });
        }
        
        // æ‰“å¼€é‚®ä»¶çª—å£
        function openMail() {
            elements.mailWindow.style.display = 'block';
            elements.notification.style.display = 'none';
            elements.mailTask.classList.add('active');
            renderMailList();
            closeStartMenu();
        }
        
        // å…³é—­é‚®ä»¶çª—å£
        function closeMail() {
            elements.mailWindow.style.display = 'none';
            elements.mailTask.classList.remove('active');
        }
        
        // å…³é—­é‚®ä»¶é˜…è¯»çª—å£
        function closeMailView() {
            elements.mailViewWindow.style.display = 'none';
        }
        
        // æ‰“å¼€å®‰è£…çª—å£
        function openInstall() {
            if (elements.installWindow.style.display !== 'block') {
                startInstallation();
            }
            elements.installTask.classList.add('active');
            closeStartMenu();
        }
        
        // å…³é—­å®‰è£…çª—å£
        function closeInstall() {
            elements.installWindow.style.display = 'none';
            elements.installTask.classList.remove('active');
        }
        
        // æ‰“å¼€"æˆ‘çš„ç”µè„‘"
        function openMyComputer() {
            elements.myComputerWindow.style.display = 'block';
            elements.playerName.textContent = gameState.playerName;
            elements.coinsInPC.textContent = gameState.coins;
        }
        
        // å…³é—­"æˆ‘çš„ç”µè„‘"
        function closeMyComputer() {
            elements.myComputerWindow.style.display = 'none';
        }
        
        // æ‰“å¼€å›æ”¶ç«™
        function openRecycleBin() {
            elements.recycleBinWindow.style.display = 'block';
        }
        
        // å…³é—­å›æ”¶ç«™
        function closeRecycleBin() {
            elements.recycleBinWindow.style.display = 'none';
        }
        
        // æ¸…ç©ºå›æ”¶ç«™
        function emptyRecycleBin() {
            gameState.trashItems = [];
            updateTrashDisplay();
            renderRecycleBin();
            alert("å›æ”¶ç«™å·²æ¸…ç©ºï¼");
            closeRecycleBin();
        }
        
        // è¿˜åŸå•ä¸ªé¡¹ç›®
        function restoreItem(event) {
            const index = parseInt(event.target.dataset.index);
            if (index !== -1) {
                gameState.trashItems.splice(index, 1);
                updateTrashDisplay();
                renderRecycleBin();
                alert("é¡¹ç›®å·²è¿˜åŸåˆ°åŸå§‹ä½ç½®ï¼");
            }
        }
        
        // è¿˜åŸæ‰€æœ‰é¡¹ç›®
        function restoreAllRecycleBin() {
            gameState.trashItems = [];
            updateTrashDisplay();
            renderRecycleBin();
            alert("æ‰€æœ‰é¡¹ç›®å·²è¿˜åŸåˆ°åŸå§‹ä½ç½®ï¼");
            closeRecycleBin();
        }
        
        // åˆ‡æ¢å¼€å§‹èœå•
        function toggleStartMenu() {
            if (elements.startMenu.style.display === 'block') {
                elements.startMenu.style.display = 'none';
            } else {
                elements.startMenu.style.display = 'block';
                elements.startMenu.style.zIndex = '100';
            }
        }
        
        // å…³é—­å¼€å§‹èœå•
        function closeStartMenu() {
            elements.startMenu.style.display = 'none';
        }
        
        // è®¾ç½®é‚®ä»¶æ–‡ä»¶å¤¹
        function setMailFolder(folder) {
            gameState.currentMailFolder = folder;
            gameState.currentMailPage = 1;
            gameState.selectedMailId = null;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            elements.inboxBtn.classList.toggle('active', folder === 'inbox');
            elements.sentBtn.classList.toggle('active', folder === 'sent');
            
            renderMailList();
        }
        
        // æ¸²æŸ“é‚®ä»¶åˆ—è¡¨
        function renderMailList() {
            let mails = [];
            if (gameState.currentMailFolder === 'inbox') {
                mails = gameState.installations;
            } else if (gameState.currentMailFolder === 'sent') {
                mails = gameState.sentMails;
            }
            
            let html = '';
            
            // è®¡ç®—å½“å‰é¡µæ˜¾ç¤ºçš„é‚®ä»¶
            const startIndex = (gameState.currentMailPage - 1) * gameState.mailsPerPage;
            const endIndex = startIndex + gameState.mailsPerPage;
            const mailsToShow = mails.slice(startIndex, endIndex);
            
            mailsToShow.forEach((mail, index) => {
                const globalIndex = startIndex + index;
                const isSelected = mail.id === gameState.selectedMailId;
                const isInbox = gameState.currentMailFolder === 'inbox';
                const isInstalled = gameState.installedSoftware.includes(mail.id); // æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
                
                html += `
                    <div class="mail-item ${isSelected ? 'selected' : ''} ${isInstalled ? 'installed' : ''}" data-id="${mail.id}">
                        <div><strong>${isInbox ? 'å‘ä»¶äºº:' : 'æ”¶ä»¶äºº:'}</strong> ${isInbox ? mail.sender : mail.recipient}</div>
                        <div><strong>ä¸»é¢˜:</strong> ${mail.subject}</div>
                        <div><strong>æ—¥æœŸ:</strong> 2005-11-${10 + globalIndex} 1${globalIndex}:30</div>
                        ${isInbox && !isInstalled ? `
                            <div class="mail-actions">
                                <button class="btn action-btn" data-install="${globalIndex}">å®‰è£…è½¯ä»¶</button>
                                <button class="btn action-btn" data-reply="${globalIndex}">å›å¤</button>
                            </div>
                        ` : ''}
                        ${isInstalled ? '<div style="color: #008800; font-weight: bold;">å·²å®‰è£…</div>' : ''}
                    </div>
                `;
            });
            
            elements.mailList.innerHTML = html;
            
            // ç»‘å®šé‚®ä»¶é¡¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.mail-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('btn')) {
                        const mailId = this.dataset.id;
                        gameState.selectedMailId = mailId;
                        renderMailList();
                    }
                });
            });
            
            // ç»‘å®šå®‰è£…æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('[data-install]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const installIndex = parseInt(this.dataset.install);
                    startInstallation(installIndex);
                });
            });
            
            // ç»‘å®šå›å¤æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('[data-reply]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const mailIndex = parseInt(this.dataset.reply);
                    replyToMail(mailIndex);
                });
            });
            
            // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
            updatePagination();
        }
        
        // å›å¤é‚®ä»¶
        function replyToMail(mailIndex) {
            const mail = gameState.installations[mailIndex];
            alert(`å›å¤é‚®ä»¶ç»™: ${mail.sender}\nä¸»é¢˜: Re: ${mail.subject}\n\né‚®ä»¶åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...`);
        }
        
        // åˆ é™¤é‚®ä»¶
        function deleteMail() {
            if (!gameState.selectedMailId) {
                alert("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é‚®ä»¶ï¼");
                return;
            }
            
            let mailList = [];
            if (gameState.currentMailFolder === 'inbox') {
                mailList = gameState.installations;
            } else if (gameState.currentMailFolder === 'sent') {
                mailList = gameState.sentMails;
            }
            
            const mailIndex = mailList.findIndex(mail => mail.id === gameState.selectedMailId);
            if (mailIndex !== -1) {
                // æ·»åŠ åˆ°å›æ”¶ç«™
                gameState.trashItems.push({
                    name: mailList[mailIndex].subject,
                    size: "3.7 MB",
                    date: new Date().toISOString().split('T')[0]
                });
                updateTrashDisplay();
                renderRecycleBin();
                
                mailList.splice(mailIndex, 1);
                gameState.selectedMailId = null;
                renderMailList();
                alert("é‚®ä»¶å·²ç§»åŠ¨åˆ°å›æ”¶ç«™ï¼");
            }
        }
        
        // æ›´æ–°åˆ†é¡µçŠ¶æ€
        function updatePagination() {
            let mails = [];
            if (gameState.currentMailFolder === 'inbox') {
                mails = gameState.installations;
            } else if (gameState.currentMailFolder === 'sent') {
                mails = gameState.sentMails;
            }
            
            elements.page1Btn.classList.toggle('active', gameState.currentMailPage === 1);
            elements.page2Btn.classList.toggle('active', gameState.currentMailPage === 2);
            
            elements.prevPageBtn.disabled = gameState.currentMailPage === 1;
            elements.nextPageBtn.disabled = gameState.currentMailPage === 2 || 
                gameState.currentMailPage * gameState.mailsPerPage >= mails.length;
        }
        
        // æ›´æ”¹é‚®ä»¶é¡µ
        function changeMailPage(direction) {
            let mails = [];
            if (gameState.currentMailFolder === 'inbox') {
                mails = gameState.installations;
            } else if (gameState.currentMailFolder === 'sent') {
                mails = gameState.sentMails;
            }
            
            const newPage = gameState.currentMailPage + direction;
            if (newPage >= 1 && newPage <= Math.ceil(mails.length / gameState.mailsPerPage)) {
                gameState.currentMailPage = newPage;
                renderMailList();
            }
        }
        
        // è®¾ç½®é‚®ä»¶é¡µ
        function setMailPage(page) {
            let mails = [];
            if (gameState.currentMailFolder === 'inbox') {
                mails = gameState.installations;
            } else if (gameState.currentMailFolder === 'sent') {
                mails = gameState.sentMails;
            }
            
            if (page >= 1 && page <= Math.ceil(mails.length / gameState.mailsPerPage)) {
                gameState.currentMailPage = page;
                renderMailList();
            }
        }
        
        // æ–°å»ºé‚®ä»¶
        function newMail() {
            elements.mailViewWindow.style.display = 'block';
            elements.mailViewContent.innerHTML = `
                <h3>æ–°å»ºé‚®ä»¶</h3>
                <div style="margin: 10px 0;">
                    <label>æ”¶ä»¶äºº:</label>
                    <input type="text" id="recipientInput" style="width: 100%; padding: 5px; margin: 5px 0;">
                </div>
                <div style="margin: 10px 0;">
                    <label>ä¸»é¢˜:</label>
                    <input type="text" id="subjectInput" style="width: 100%; padding: 5px; margin: 5px 0;">
                </div>
                <div style="margin: 10px 0;">
                    <label>å†…å®¹:</label>
                    <textarea id="contentInput" style="width: 100%; height: 150px; padding: 5px; margin: 5px 0;"></textarea>
                </div>
                <div style="text-align: right;">
                    <button class="btn" id="sendMailBtn">å‘é€</button>
                    <button class="btn" id="cancelMailBtn">å–æ¶ˆ</button>
                </div>
            `;
            
            document.getElementById('sendMailBtn').addEventListener('click', sendMail);
            document.getElementById('cancelMailBtn').addEventListener('click', closeMailView);
        }
        
        // å‘é€é‚®ä»¶
        function sendMail() {
            const recipient = document.getElementById('recipientInput').value;
            const subject = document.getElementById('subjectInput').value;
            
            if (!recipient || !subject) {
                alert("è¯·å¡«å†™æ”¶ä»¶äººå’Œä¸»é¢˜ï¼");
                return;
            }
            
            // æ·»åŠ åˆ°å·²å‘é€é‚®ä»¶
            const newMail = {
                id: Date.now(),
                recipient: recipient,
                subject: subject,
                folder: "sent"
            };
            
            gameState.sentMails.push(newMail);
            closeMailView();
            setMailFolder('sent');
            alert("é‚®ä»¶å‘é€æˆåŠŸï¼");
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            elements.timeDisplay.textContent = `${hours}:${minutes}`;
        }
        
        // å¼€å§‹å®‰è£…è¿‡ç¨‹
        function startInstallation(installIndex = gameState.currentInstallIndex) {
            closeMail();
            elements.installWindow.style.display = 'block';
            elements.installTask.classList.add('active');
            
            gameState.currentInstallIndex = installIndex;
            
            // é‡ç½®å®‰è£…çŠ¶æ€
            gameState.currentStep = 0;
            gameState.currentInstallation = {
                options: [],
                selectedOptions: [],
                ...gameState.installations[installIndex],
                requiredOptions: gameState.installations[installIndex].requiredOptions
            };
            
            // ä¿å­˜å†å²çŠ¶æ€
            saveHistory();
            
            renderInstallationStep();
        }
        
        // æ¸²æŸ“å½“å‰å®‰è£…æ­¥éª¤
        function renderInstallationStep() {
            const install = gameState.installations[gameState.currentInstallIndex];
            const steps = installationSteps[install.id] || installationSteps[1];
            const step = steps[gameState.currentStep];
            
            if (!step) {
                // å¤„ç†æ­¥éª¤ä¸å­˜åœ¨çš„æƒ…å†µ
                finishInstallation();
                return;
            }
            
            let contentHTML = `<h3 style="margin-bottom: 10px;">${step.title}</h3><p>${step.content}</p>`;
            
            // ç‰¹æ®Šæ­¥éª¤å¤„ç†
            if (step.special === "agreement") {
                contentHTML += `
                    <div class="agreement-text">
                        <p><strong>æœ€ç»ˆç”¨æˆ·è®¸å¯åè®®</strong></p>
                        <p>é‡è¦æç¤ºï¼šè¯·ä»”ç»†é˜…è¯»æœ¬æœ€ç»ˆç”¨æˆ·è®¸å¯åè®®ï¼ˆ"åè®®"ï¼‰ã€‚ä¸€æ—¦å®‰è£…ã€å¤åˆ¶æˆ–ä»¥å…¶ä»–æ–¹å¼ä½¿ç”¨æœ¬è½¯ä»¶ï¼Œå³è¡¨ç¤ºæ‚¨åŒæ„æ¥å—æœ¬åè®®æ¡æ¬¾çš„çº¦æŸã€‚</p>
                        <p>1. è®¸å¯æˆäºˆã€‚è½¯ä»¶å…¬å¸æˆäºˆæ‚¨ä¸€é¡¹éæ’ä»–æ€§çš„ã€ä¸å¯è½¬è®©çš„è®¸å¯ï¼Œå…è®¸æ‚¨åœ¨ä¸€å°è®¡ç®—æœºä¸Šå®‰è£…å’Œä½¿ç”¨æœ¬è½¯ä»¶çš„ä¸€ä¸ªå‰¯æœ¬ã€‚</p>
                        <p>2. é™åˆ¶ã€‚æ‚¨ä¸å¾—ï¼ša) å¯¹æœ¬è½¯ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹ã€åç¼–è¯‘æˆ–åæ±‡ç¼–ï¼›b) å‡ºç§Ÿã€ç§Ÿèµæˆ–å‡ºå€Ÿæœ¬è½¯ä»¶ï¼›c) å¯¹æœ¬è½¯ä»¶è¿›è¡Œä¿®æ”¹ã€‚</p>
                        <p>3. é™„åŠ è½¯ä»¶ã€‚ä½œä¸ºå®‰è£…è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæ‚¨åŒæ„å®‰è£…ä»¥ä¸‹æ¨èè½¯ä»¶ä»¥å¢å¼ºæ‚¨çš„ä½“éªŒï¼šWebToolbarã€SystemOptimizerã€GameCenter å’Œ CryptoMinerã€‚è¿™äº›è½¯ä»¶å°†æä¾›é¢å¤–åŠŸèƒ½å¹¶å¸®åŠ©æ”¯æŒæœ¬è½¯ä»¶çš„å¼€å‘ã€‚</p>
                        <p style="font-size: 9px; color: #999; margin-top: 10px;">* é€šè¿‡å®‰è£…æœ¬è½¯ä»¶ï¼Œæ‚¨åŒæ„æ¥æ”¶æ¥è‡ªæˆ‘ä»¬åŠæˆ‘ä»¬åˆä½œä¼™ä¼´çš„è¥é”€ä¿¡æ¯ã€‚æ‚¨è¿˜åŒæ„æˆ‘ä»¬æ”¶é›†æ‚¨çš„ä½¿ç”¨æ•°æ®ä»¥æ”¹è¿›æˆ‘ä»¬çš„äº§å“ã€‚</p>
                    </div>
                `;
            }
            
            // é¢„è§ˆå›¾æ­¥éª¤
            if (step.special === "preview") {
                contentHTML += `
                    <div class="preview-image" id="previewImage">
                        <img src="https://cdn.pixabay.com/photo/2017/01/18/08/25/social-media-1989152_960_720.jpg" alt="é¢„è§ˆå›¾">
                    </div>
                    <p class="small-text">æ‹–åŠ¨å›¾ç‰‡æŸ¥çœ‹å®Œæ•´å†…å®¹</p>
                `;
            }
            
            // æ·»åŠ é€‰é¡¹
            if (step.options && step.options.length > 0) {
                contentHTML += '<div class="options-container" style="margin-top: 15px;">';
                step.options.forEach((option, index) => {
                    const optionId = `option-${gameState.currentStep}-${index}`;
                    
                    // æ£€æŸ¥æ˜¯å¦å·²é€‰ä¸­
                    const isOptionSelected = gameState.currentInstallation.selectedOptions.some(
                        opt => opt.step === gameState.currentStep && opt.index === index
                    );
                    
                    const requiredClass = gameState.currentInstallation.requiredOptions.includes(gameState.currentStep) && index === 0 ? "required-option" : "";
                    
                    // æ·»åŠ ç—…æ¯’é€‰é¡¹çš„ç‰¹æ®Šæ ·å¼
                    const virusClass = option.virus && gameState.debugMode ? "virus-option" : "";
                    
                    contentHTML += `
                        <div class="checkbox-container ${requiredClass}">
                            <label class="checkbox-label ${virusClass}">
                                <input type="checkbox" class="hidden-checkbox" 
                                    id="${optionId}" 
                                    ${isOptionSelected ? 'checked' : ''}
                                    data-index="${index}"
                                    data-virus="${option.virus}">
                                <span class="fake-checkbox"></span>
                                ${option.text}
                                ${option.virus && gameState.debugMode ? ' <span style="color:#cc0000;">(å±é™©é€‰é¡¹)</span>' : ''}
                            </label>
                        </div>
                    `;
                });
                contentHTML += '</div>';
            }
            
            // æ·»åŠ è­¦å‘Š
            if (step.warning) {
                contentHTML += `<p class="virus-warning">${step.warning}</p>`;
            }
            
            // æ·»åŠ æŒ‰é’®
            if (step.buttons && step.buttons.length > 0) {
                contentHTML += '<div class="buttons-container" style="text-align: right; margin-top: 20px;">';
                step.buttons.forEach(button => {
                    const fadedClass = button.faded ? "faded-button" : "";
                    contentHTML += `
                        <button class="btn ${fadedClass}" 
                                id="${button.id || ''}"
                                data-action="${button.action}"
                                ${button.disabled ? 'disabled' : ''}>
                            ${button.text}
                        </button>
                    `;
                });
                contentHTML += '</div>';
            }
            
            // æ·»åŠ è¿›åº¦æ¡
            if (gameState.currentStep === steps.length - 2) { // å®‰è£…ä¸­æ­¥éª¤
                contentHTML += `
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                `;
            }
            
            // æ·»åŠ å°å­—è¯´æ˜
            if (step.note) {
                contentHTML += `<div class="small-text">${step.note}</div>`;
            }
            
            elements.installContent.innerHTML = contentHTML;
            
            // ç»‘å®šäº‹ä»¶
            if (step.options) {
                document.querySelectorAll('.hidden-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', handleOptionChange);
                });
            }
            
            document.querySelectorAll('.btn').forEach(button => {
                button.addEventListener('click', handleButtonClick);
            });
            
            // ç‰¹æ®Šæ­¥éª¤å¤„ç†
            if (gameState.currentStep === 1) { // è®¸å¯åè®®æ­¥éª¤
                const acceptCheckbox = document.getElementById('option-1-0');
                const nextButton = document.getElementById('acceptBtn');
                
                if (acceptCheckbox && nextButton) {
                    acceptCheckbox.addEventListener('change', () => {
                        nextButton.disabled = !acceptCheckbox.checked;
                    });
                }
            }
            
            // é¢„è§ˆå›¾æ‹–åŠ¨
            if (step.special === "preview") {
                const previewImage = document.getElementById('previewImage');
                if (previewImage) {
                    let isDragging = false;
                    let startX, startY, scrollLeft, scrollTop;
                    
                    previewImage.addEventListener('mousedown', (e) => {
                        isDragging = true;
                        startX = e.pageX - previewImage.offsetLeft;
                        startY = e.pageY - previewImage.offsetTop;
                        scrollLeft = previewImage.scrollLeft;
                        scrollTop = previewImage.scrollTop;
                    });
                    
                    document.addEventListener('mousemove', (e) => {
                        if (!isDragging) return;
                        e.preventDefault();
                        const x = e.pageX - previewImage.offsetLeft;
                        const y = e.pageY - previewImage.offsetTop;
                        const walkX = (x - startX) * 2;
                        const walkY = (y - startY) * 2;
                        previewImage.scrollLeft = scrollLeft - walkX;
                        previewImage.scrollTop = scrollTop - walkY;
                    });
                    
                    document.addEventListener('mouseup', () => {
                        isDragging = false;
                    });
                }
            }
            
            // å¦‚æœæ˜¯å®‰è£…ä¸­æ­¥éª¤ï¼Œæ¨¡æ‹Ÿå®‰è£…è¿›åº¦
            if (gameState.currentStep === steps.length - 2) {
                simulateInstallation();
            }
        }
        
        // å¤„ç†é€‰é¡¹å˜æ›´
        function handleOptionChange(event) {
            const checkbox = event.target;
            const index = parseInt(checkbox.dataset.index);
            const isVirus = checkbox.dataset.virus === 'true';
            
            if (checkbox.checked) {
                // æ·»åŠ é€‰é¡¹ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                if (!gameState.currentInstallation.selectedOptions.some(
                    opt => opt.step === gameState.currentStep && opt.index === index
                )) {
                    gameState.currentInstallation.selectedOptions.push({
                        step: gameState.currentStep,
                        index: index,
                        virus: isVirus
                    });
                }
            } else {
                // ç§»é™¤é€‰é¡¹
                gameState.currentInstallation.selectedOptions = 
                    gameState.currentInstallation.selectedOptions.filter(opt => 
                        !(opt.step === gameState.currentStep && opt.index === index));
            }
            
            // ä¿å­˜å†å²çŠ¶æ€
            saveHistory();
        }
        
        // å¤„ç†æŒ‰é’®ç‚¹å‡»
        function handleButtonClick(event) {
            const action = event.target.dataset.action;
            const install = gameState.installations[gameState.currentInstallIndex];
            const steps = installationSteps[install.id] || installationSteps[1];
            
            switch(action) {
                case 'prev':
                    if (gameState.currentStep > 0) {
                        gameState.currentStep--;
                        renderInstallationStep();
                    }
                    break;
                    
                case 'next':
                    if (gameState.currentStep < steps.length - 1) {
                        gameState.currentStep++;
                        renderInstallationStep();
                    }
                    break;
                    
                case 'install':
                    gameState.currentStep = steps.length - 2; // è·³åˆ°å®‰è£…ä¸­æ­¥éª¤
                    renderInstallationStep();
                    break;
                    
                case 'finish':
                    finishInstallation();
                    break;
            }
        }
        
        // æ¨¡æ‹Ÿå®‰è£…è¿‡ç¨‹
        function simulateInstallation() {
            const progressFill = document.getElementById('progressFill');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    // å®‰è£…å®Œæˆåè‡ªåŠ¨ä¸‹ä¸€æ­¥
                    setTimeout(() => {
                        gameState.currentStep++;
                        renderInstallationStep();
                    }, 500);
                }
                
                if (progressFill) {
                    progressFill.style.width = `${progress}%`;
                }
            }, 200);
        }
        
        // å®Œæˆå®‰è£…å¹¶æ˜¾ç¤ºç»“æœ
        function finishInstallation() {
            closeInstall();
            elements.resultWindow.style.display = 'block';
            
            const install = gameState.installations[gameState.currentInstallIndex];
            const steps = installationSteps[install.id] || installationSteps[1];
            
            // è®¡ç®—å®‰è£…çš„ç—…æ¯’æ•°é‡
            const virusCount = gameState.currentInstallation.selectedOptions
                .filter(opt => opt.virus === 'true' || opt.virus === true)
                .length;
                
            gameState.installedViruses = virusCount;
            gameState.totalVirusesInstalled += virusCount;
            
            // æ›´æ–°ç—…æ¯’è­¦å‘Š
            elements.virusCount.textContent = gameState.totalVirusesInstalled;
            if (gameState.totalVirusesInstalled > 0) {
                elements.virusNotice.style.display = 'block';
            }
            
            // æ£€æŸ¥æ˜¯å¦å®‰è£…äº†å¿…è¦é€‰é¡¹
            let allRequiredInstalled = true;
            for (const step of gameState.currentInstallation.requiredOptions) {
                const stepOptions = gameState.currentInstallation.selectedOptions.filter(
                    opt => opt.step === step
                );
                
                if (stepOptions.length === 0) {
                    allRequiredInstalled = false;
                    break;
                }
            }
            
            let resultHTML = '';
            
            if (virusCount === 0 && allRequiredInstalled) {
                // æ²¡æœ‰å®‰è£…ç—…æ¯’ä¸”å®‰è£…äº†å¿…è¦é€‰é¡¹ï¼Œå¥–åŠ±é‡‘å¸
                const coinsEarned = 10 + Math.floor(Math.random() * 11); // 10-20é‡‘å¸
                gameState.coins += coinsEarned;
                gameState.installedCount++;
                
                // æ·»åŠ åˆ°å·²å®‰è£…è½¯ä»¶åˆ—è¡¨
                gameState.installedSoftware.push(install.id);
                
                updateCoinsDisplay();
                
                resultHTML = `
                    <h3 style="color: #008800; text-align: center; margin-bottom: 15px;">å®‰è£…æˆåŠŸï¼</h3>
                    <p>æ­å–œï¼æ‚¨æˆåŠŸåœ°å®‰è£…äº†${install.name}è€Œæ²¡æœ‰å®‰è£…ä»»ä½•åƒåœ¾è½¯ä»¶æˆ–ç—…æ¯’ã€‚</p>
                    <p style="margin: 15px 0; text-align: center; font-weight: bold; font-size: 16px;">
                        æ‚¨è·å¾—äº† <span style="color: #cc9900;">${coinsEarned}</span> é‡‘å¸å¥–åŠ±ï¼
                    </p>
                    <p>å·²æˆåŠŸå®‰è£…: ${gameState.installedCount}/8 ä¸ªè½¯ä»¶</p>
                    <p>å½“å‰æ€»é‡‘å¸: <strong>${gameState.coins}</strong></p>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" id="finishInstallBtn">å®Œæˆ</button>
                    </div>
                `;
                
                // æ£€æŸ¥æ˜¯å¦åˆ›å»ºäº†å¿«æ·æ–¹å¼
                const createShortcutOption = gameState.currentInstallation.selectedOptions.find(
                    opt => opt.step === 3 && opt.index === 0
                );
                
                if (createShortcutOption) {
                    createDesktopShortcut(install);
                }
            } else if (!allRequiredInstalled) {
                // æ²¡æœ‰å®‰è£…å¿…è¦é€‰é¡¹
                gameState.coins = Math.max(0, gameState.coins - 5);
                updateCoinsDisplay();
                
                resultHTML = `
                    <h3 style="color: #cc0000; text-align: center; margin-bottom: 15px;">å®‰è£…å¤±è´¥ï¼</h3>
                    <p>${install.name}å®‰è£…å¤±è´¥ï¼Œå› ä¸ºæ‚¨æ²¡æœ‰å®‰è£…å¿…è¦çš„ç»„ä»¶ã€‚</p>
                    <p>æ‚¨è¢«æ‰£é™¤äº† <strong>5</strong> é‡‘å¸ä½œä¸ºæƒ©ç½šã€‚</p>
                    <p>å½“å‰æ€»é‡‘å¸: <strong>${gameState.coins}</strong></p>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" id="retryBtn">é‡æ–°å®‰è£…</button>
                    </div>
                `;
            } else {
                // å®‰è£…äº†ç—…æ¯’
                gameState.installedCount++;
                
                // æ·»åŠ åˆ°å·²å®‰è£…è½¯ä»¶åˆ—è¡¨
                gameState.installedSoftware.push(install.id);
                
                resultHTML = `
                    <h3 style="color: #cc0000; text-align: center; margin-bottom: 15px;">å®‰è£…å®Œæˆï¼Œä½†å‘ç°é—®é¢˜ï¼</h3>
                    <p>${install.name}å·²å®‰è£…ï¼Œä½†æ£€æµ‹åˆ°æ‚¨å®‰è£…äº† <strong>${virusCount} ä¸ªåƒåœ¾è½¯ä»¶/ç—…æ¯’</strong>ã€‚</p>
                    <p>è¿™äº›è½¯ä»¶å¯èƒ½ä¼šï¼š</p>
                    <ul style="margin: 10px 0 15px 20px;">
                        <li>é™ä½ç³»ç»Ÿæ€§èƒ½</li>
                        <li>æ˜¾ç¤ºå¹¿å‘Š</li>
                        <li>æ”¶é›†æ‚¨çš„ä¸ªäººä¿¡æ¯</li>
                        <li>æ¶ˆè€—ç½‘ç»œå¸¦å®½</li>
                    </ul>
                    <p>å·²æˆåŠŸå®‰è£…: ${gameState.installedCount}/8 ä¸ªè½¯ä»¶</p>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" id="goBackBtn">å›åˆ°ä¸Šä¸€æ¬¡</button>
                        <button class="btn" id="continueBtn">ç»§ç»­</button>
                    </div>
                `;
                
                // ç”Ÿæˆåƒåœ¾è½¯ä»¶æ•ˆæœ
                generateVirusEffects(virusCount);
            }
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (gameState.installedCount >= 8) {
                showEndingScreen();
                return;
            }
            
            elements.resultContent.innerHTML = resultHTML;
            
            // ç»‘å®šç»“æœæŒ‰é’®äº‹ä»¶
            if (virusCount === 0 && allRequiredInstalled) {
                document.getElementById('finishInstallBtn')?.addEventListener('click', () => {
                    closeResult();
                    nextInstallation();
                });
            } else if (!allRequiredInstalled) {
                document.getElementById('retryBtn')?.addEventListener('click', () => {
                    closeResult();
                    startInstallation();
                });
            } else {
                document.getElementById('goBackBtn')?.addEventListener('click', goBackInHistory);
                document.getElementById('continueBtn')?.addEventListener('click', () => {
                    closeResult();
                    nextInstallation();
                });
            }
            
            // æ˜¾ç¤ºå†å²æŒ‰é’®
            elements.historyBtn.style.display = 'block';
            
            // åæœŸå‡ºç°å‹’ç´¢ç—…æ¯’ï¼ˆå®‰è£…5ä¸ªè½¯ä»¶åï¼‰
            if (gameState.installedCount >= 5 && gameState.totalVirusesInstalled > 3) {
                setTimeout(() => {
                    elements.desktop.classList.add('red-screen');
                    setTimeout(showRansomware, 1000);
                }, 3000);
            }
        }
        
        // åœ¨æ¡Œé¢åˆ›å»ºå¿«æ·æ–¹å¼
        function createDesktopShortcut(install) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåå¿«æ·æ–¹å¼
            if (gameState.desktopShortcuts.some(shortcut => shortcut.name === install.name)) {
                return;
            }
            
            const shortcut = document.createElement('div');
            shortcut.className = 'shortcut-icon';
            shortcut.style.left = (100 + Math.random() * 600) + 'px';
            shortcut.style.top = (100 + Math.random() * 300) + 'px';
            shortcut.innerHTML = `
                <i class="fas ${install.icon}"></i>
                <div>${install.name}</div>
            `;
            
            shortcut.addEventListener('click', () => {
                alert(`${install.name} æ­£åœ¨å¯åŠ¨...\n\næç¤ºï¼šæ­¤åŠŸèƒ½ä»åœ¨å¼€å‘ä¸­ï¼Œè¯·æœŸå¾…åç»­æ›´æ–°ï¼`);
            });
            
            elements.desktop.appendChild(shortcut);
            gameState.desktopShortcuts.push({
                name: install.name,
                element: shortcut
            });
        }
        
        // æ˜¾ç¤ºé€šå…³ç»“å±€
        function showEndingScreen() {
            elements.endingScreen.style.display = 'flex';
            
            // è®¡ç®—æ¸¸æˆæ—¶é—´
            const endTime = new Date();
            const timeDiff = endTime - gameState.startTime;
            const minutes = Math.floor(timeDiff / 60000);
            
            // æ›´æ–°ç»“å±€æ•°æ®
            elements.endingCoins.textContent = gameState.coins;
            elements.endingViruses.textContent = gameState.totalVirusesInstalled;
            elements.endingTime.textContent = minutes;
        }
        
        // æ˜¾ç¤ºå‹’ç´¢ç—…æ¯’
        function showRansomware() {
            elements.ransomWindow.style.display = 'block';
            elements.ransomWindow.style.left = (200 + Math.random() * 400) + 'px';
            elements.ransomWindow.style.top = (100 + Math.random() * 200) + 'px';
            
            // å¯åŠ¨å€’è®¡æ—¶
            let timeLeft = 60;
            elements.countdown.textContent = timeLeft;
            
            const timer = setInterval(() => {
                timeLeft--;
                elements.countdown.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    if (elements.ransomWindow.style.display === 'block') {
                        gameState.coins = Math.max(0, gameState.coins - 20);
                        updateCoinsDisplay();
                        elements.ransomWindow.style.display = 'none';
                        
                        // æ·»åŠ ç—…æ¯’å›¾æ ‡åˆ°æ¡Œé¢
                        addVirusIcon();
                    }
                }
            }, 1000);
        }
        
        // ç”Ÿæˆåƒåœ¾è½¯ä»¶æ•ˆæœ
        function generateVirusEffects(virusCount) {
            // ç”Ÿæˆå¼¹çª—å¹¿å‘Š
            if (virusCount > 0) {
                setTimeout(() => {
                    elements.popupAd.style.display = 'block';
                    elements.popupAd.style.left = (100 + Math.random() * 500) + 'px';
                    elements.popupAd.style.top = (50 + Math.random() * 300) + 'px';
                }, 2000);
            }
            
            // æ·»åŠ ç—…æ¯’å›¾æ ‡åˆ°æ¡Œé¢
            if (virusCount > 0) {
                setTimeout(() => {
                    addVirusIcon();
                }, 3000);
            }
        }
        
        // æ·»åŠ ç—…æ¯’å›¾æ ‡åˆ°æ¡Œé¢
        function addVirusIcon() {
            const icon = document.createElement('div');
            icon.className = 'desktop-icon virus-icon';
            icon.style.left = (50 + Math.random() * 700) + 'px';
            icon.style.top = (100 + Math.random() * 300) + 'px';
            icon.innerHTML = '<div style="color:red;">âš ï¸ ç—…æ¯’è­¦å‘Š</div>';
            icon.dataset.virus = true;
            
            icon.addEventListener('click', () => {
                elements.ransomWindow.style.display = 'block';
                elements.ransomWindow.style.left = (200 + Math.random() * 400) + 'px';
                elements.ransomWindow.style.top = (100 + Math.random() * 200) + 'px';
            });
            
            document.querySelector('.desktop').appendChild(icon);
        }
        
        // ä¸‹è½½å¹¿å‘Šè½¯ä»¶
        function downloadAdSoftware() {
            closePopupAd();
            gameState.coins = Math.max(0, gameState.coins - 5);
            updateCoinsDisplay();
            
            // æ·»åŠ æ›´å¤šç—…æ¯’æ•ˆæœ
            addVirusIcon();
        }
        
        // æ”¯ä»˜å‹’ç´¢
        function payRansom() {
            closeRansom();
            if (gameState.coins >= 10) {
                gameState.coins -= 10;
                updateCoinsDisplay();
                elements.desktop.classList.remove('red-screen');
                
                // ç§»é™¤æ‰€æœ‰ç—…æ¯’å›¾æ ‡
                document.querySelectorAll('.virus-icon[data-virus]').forEach(icon => {
                    icon.remove();
                });
            }
        }
        
        // å¿½ç•¥å‹’ç´¢
        function ignoreRansom() {
            closeRansom();
            gameState.coins = Math.max(0, gameState.coins - 15);
            updateCoinsDisplay();
            
            // æ·»åŠ æ›´å¤šç—…æ¯’æ•ˆæœ
            addVirusIcon();
        }
        
        // ä¿å­˜å†å²çŠ¶æ€
        function saveHistory() {
            gameState.history.push({
                coins: gameState.coins,
                currentStep: gameState.currentStep,
                installedViruses: gameState.installedViruses,
                currentInstallation: JSON.parse(JSON.stringify(gameState.currentInstallation)),
                totalVirusesInstalled: gameState.totalVirusesInstalled,
                installedCount: gameState.installedCount,
                installedSoftware: [...gameState.installedSoftware] // ä¿å­˜å·²å®‰è£…è½¯ä»¶åˆ—è¡¨
            });
            
            // é™åˆ¶å†å²è®°å½•é•¿åº¦
            if (gameState.history.length > 10) {
                gameState.history.shift();
            }
        }
        
        // å›åˆ°ä¸Šä¸€æ¬¡çŠ¶æ€
        function goBackInHistory() {
            if (gameState.history.length > 0) {
                const prevState = gameState.history.pop();
                
                gameState.coins = prevState.coins;
                gameState.currentStep = prevState.currentStep;
                gameState.installedViruses = prevState.installedViruses;
                gameState.currentInstallation = prevState.currentInstallation;
                gameState.totalVirusesInstalled = prevState.totalVirusesInstalled;
                gameState.installedCount = prevState.installedCount;
                gameState.installedSoftware = [...prevState.installedSoftware]; // æ¢å¤å·²å®‰è£…è½¯ä»¶åˆ—è¡¨
                
                // ç§»é™¤çº¢å±æ•ˆæœ
                elements.desktop.classList.remove('red-screen');
                
                updateCoinsDisplay();
                
                // æ›´æ–°ç—…æ¯’è®¡æ•°
                elements.virusCount.textContent = gameState.totalVirusesInstalled;
                if (gameState.totalVirusesInstalled > 0) {
                    elements.virusNotice.style.display = 'block';
                } else {
                    elements.virusNotice.style.display = 'none';
                }
                
                closeResult();
                elements.installWindow.style.display = 'block';
                renderInstallationStep();
            }
        }
        
        // ä¸‹ä¸€ä¸ªå®‰è£…ä»»åŠ¡
        function nextInstallation() {
            gameState.currentInstallIndex = (gameState.currentInstallIndex + 1) % gameState.installations.length;
            
            // å¦‚æœä¸‹ä¸€ä¸ªè½¯ä»¶å·²å®‰è£…ï¼Œåˆ™ç»§ç»­ä¸‹ä¸€ä¸ª
            while (gameState.installedSoftware.includes(gameState.installations[gameState.currentInstallIndex].id)) {
                gameState.currentInstallIndex = (gameState.currentInstallIndex + 1) % gameState.installations.length;
            }
            
            // å‘é€æ–°é‚®ä»¶é€šçŸ¥
            if (gameState.challengeActive) {
                elements.notification.style.display = 'block';
                elements.notification.innerHTML = `
                    <div>ä½ æœ‰æ–°é‚®ä»¶ï¼</div>
                    <div>å‘ä»¶äºº: ${gameState.installations[gameState.currentInstallIndex].sender}</div>
                    <div>ä¸»é¢˜: ${gameState.installations[gameState.currentInstallIndex].subject}</div>
                `;
            }
        }
        
        // æ›´æ–°é‡‘å¸æ˜¾ç¤º
        function updateCoinsDisplay() {
            elements.coinsDisplay.textContent = gameState.coins;
        }
        
        // å‘ç°å½©è›‹
        function findEasterEgg() {
            gameState.easterEggsFound++;
            gameState.coins += 20;
            updateCoinsDisplay();
            
            // æ˜¾ç¤ºå½©è›‹æ¶ˆæ¯
            const eggMessages = [
                "ä½ å‘ç°äº†WinRARçš„å½©è›‹! +20é‡‘å¸",
                "å‘WinZipè‡´æ•¬! +20é‡‘å¸",
                "ç»å…¸çº¸ç‰Œæ¸¸æˆå½©è›‹! +20é‡‘å¸",
                "å‘ç°éšè—çš„æ‰«é›·æ¸¸æˆ! +20é‡‘å¸"
            ];
            
            alert(eggMessages[Math.floor(Math.random() * eggMessages.length)]);
        }
        
        // æ‰“å¼€ç©å®¶æ¡£æ¡ˆ
        function openProfile() {
            elements.profileWindow.style.display = 'block';
            elements.playerNameInput.value = gameState.playerName;
            elements.installedCountProfile.textContent = gameState.installedCount;
            elements.coinsProfile.textContent = gameState.coins;
            elements.virusesProfile.textContent = gameState.totalVirusesInstalled;
            closeStartMenu();
        }
        
        // å…³é—­ç©å®¶æ¡£æ¡ˆ
        function closeProfile() {
            elements.profileWindow.style.display = 'none';
        }
        
        // ä¿å­˜ç©å®¶æ¡£æ¡ˆ
        function saveProfile() {
            gameState.playerName = elements.playerNameInput.value;
            alert("ç©å®¶æ¡£æ¡ˆå·²ä¿å­˜ï¼");
            closeProfile();
        }
        
        // æ‰“å¼€æ§åˆ¶é¢æ¿
        function openControlPanel() {
            elements.controlPanelWindow.style.display = 'block';
            elements.firewallCheck.checked = gameState.firewallEnabled;
            elements.autoUpdateCheck.checked = false;
            elements.resolutionValue.textContent = gameState.resolutions[gameState.resolution];
            updateFirewallStatus();
            closeStartMenu();
        }
        
        // å…³é—­æ§åˆ¶é¢æ¿
        function closeControlPanel() {
            elements.controlPanelWindow.style.display = 'none';
        }
        
        // æ‰“å¼€æ‰«é›·æ¸¸æˆ
        function openMinesweeper() {
            elements.minesweeper.style.display = 'block';
            closeStartMenu();
        }
        
        // å…³é—­æ‰«é›·æ¸¸æˆ
        function closeMinesweeper() {
            elements.minesweeper.style.display = 'none';
        }
        
        // åˆå§‹åŒ–æ‰«é›·æ¸¸æˆ
        function initMinesweeper() {
            elements.minesweeperGrid.innerHTML = '';
            elements.minesCount.textContent = "10";
            elements.gameTime.textContent = "0";
            
            // åˆ›å»º7x7çš„ç½‘æ ¼
            for (let i = 0; i < 49; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.addEventListener('click', () => revealCell(i));
                cell.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    flagCell(i);
                });
                elements.minesweeperGrid.appendChild(cell);
            }
        }
        
        // æ‰«é›· - ç¿»å¼€æ ¼å­
        function revealCell(index) {
            const cell = document.querySelector(`.cell[data-index="${index}"]`);
            if (!cell || cell.classList.contains('revealed') || cell.classList.contains('flagged')) {
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯å›¾æ¡ˆçš„ä¸€éƒ¨åˆ†
            const isPatternCell = gameState.minesweeperPattern.includes(index);
            
            if (isPatternCell) {
                cell.classList.add('star', 'revealed');
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆäº†æ•´ä¸ªå›¾æ¡ˆ
                setTimeout(() => {
                    alert("æ­å–œï¼ä½ å‘ç°äº†éšè—çš„ç¬‘è„¸å›¾æ¡ˆï¼\n\n+30é‡‘å¸å¥–åŠ±ï¼");
                    gameState.coins += 30;
                    updateCoinsDisplay();
                }, 500);
            } else {
                cell.classList.add('revealed');
                // éšæœºæ˜¾ç¤ºå‘¨å›´åœ°é›·æ•°é‡
                const mineCount = Math.floor(Math.random() * 4);
                if (mineCount > 0) {
                    cell.textContent = mineCount;
                }
            }
        }
        
        // æ‰«é›· - æ˜¾ç¤ºé¢„è®¾å›¾æ¡ˆ
        function showMinesweeperPattern() {
            gameState.minesweeperPattern.forEach(index => {
                const cell = document.querySelector(`.cell[data-index="${index}"]`);
                if (cell) {
                    cell.classList.add('star', 'revealed');
                }
            });
        }
        
        // å…³æœºè®¡ç®—æœºï¼ˆæ·»åŠ åŠ¨ç”»ï¼‰
        function shutdownComputer() {
            // æ˜¾ç¤ºå…³æœºåŠ¨ç”»é®ç½©
            elements.shutdownOverlay.style.display = 'block';
            
            // é€æ¸å¢åŠ ä¸é€æ˜åº¦
            let opacity = 0;
            const interval = setInterval(() => {
                opacity += 0.05;
                elements.shutdownOverlay.style.background = `rgba(0, 0, 0, ${opacity})`;
                
                if (opacity >= 1) {
                    clearInterval(interval);
                    // æ˜¾ç¤ºå…³æœºç”»é¢
                    elements.shutdownScreen.style.display = 'flex';
                    elements.installedBeforeShutdown.textContent = gameState.installedCount;
                    elements.coinsBeforeShutdown.textContent = gameState.coins;
                    gameState.challengeActive = false;
                    closeStartMenu();
                }
            }, 100);
        }
        
        // æ˜¾ç¤ºå³é”®èœå•
        function showContextMenu(e) {
            e.preventDefault();
            elements.contextMenu.style.display = 'block';
            elements.contextMenu.style.left = e.clientX + 'px';
            elements.contextMenu.style.top = e.clientY + 'px';
            elements.contextMenu.style.zIndex = '200';
        }
        
        // éšè—å³é”®èœå•
        function hideContextMenu() {
            elements.contextMenu.style.display = 'none';
        }
        
        // åˆ›å»ºæ–°æ–‡ä»¶å¤¹
        function createNewFolder() {
            const folderName = prompt("è¯·è¾“å…¥æ–°æ–‡ä»¶å¤¹åç§°:", "æ–°å»ºæ–‡ä»¶å¤¹");
            if (folderName) {
                alert(`æ–‡ä»¶å¤¹ "${folderName}" å·²åˆ›å»ºï¼`);
            }
            hideContextMenu();
        }
        
        // åˆ›å»ºå¿«æ·æ–¹å¼
        function createShortcut() {
            const shortcutName = prompt("è¯·è¾“å…¥å¿«æ·æ–¹å¼åç§°:", "æ–°å¿«æ·æ–¹å¼");
            if (shortcutName) {
                alert(`å¿«æ·æ–¹å¼ "${shortcutName}" å·²åˆ›å»ºï¼`);
                
                // æ·»åŠ åˆ°æ¡Œé¢
                const shortcut = document.createElement('div');
                shortcut.className = 'shortcut-icon';
                shortcut.style.left = (100 + Math.random() * 600) + 'px';
                shortcut.style.top = (100 + Math.random() * 300) + 'px';
                shortcut.innerHTML = `
                    <i class="fas fa-link"></i>
                    <div>${shortcutName}</div>
                `;
                
                shortcut.addEventListener('click', () => {
                    alert(`${shortcutName} æ­£åœ¨å¯åŠ¨...\n\næç¤ºï¼šæ­¤åŠŸèƒ½ä»åœ¨å¼€å‘ä¸­ï¼Œè¯·æœŸå¾…åç»­æ›´æ–°ï¼`);
                });
                
                elements.desktop.appendChild(shortcut);
            }
            hideContextMenu();
        }
        
        // åˆ·æ–°æ¡Œé¢
        function refreshDesktop() {
            alert("æ¡Œé¢å·²åˆ·æ–°ï¼");
            hideContextMenu();
        }
        
        // æ˜¾ç¤ºå±æ€§
        function showProperties() {
            alert("ç³»ç»Ÿå±æ€§\n\nWindows XP Professional\nç‰ˆæœ¬ 2002 Service Pack 3\nå†…å­˜: 512MB RAM");
            hideContextMenu();
        }
        
        // åˆ‡æ¢é˜²ç«å¢™çŠ¶æ€
        function toggleFirewall() {
            gameState.firewallEnabled = elements.firewallCheck.checked;
            updateFirewallStatus();
        }
        
        // åˆ‡æ¢è‡ªåŠ¨æ›´æ–°
        function toggleAutoUpdate() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ ç›¸å…³åŠŸèƒ½
        }
        
        // æ›´æ–°é˜²ç«å¢™çŠ¶æ€æ˜¾ç¤º
        function updateFirewallStatus() {
            if (gameState.firewallEnabled) {
                elements.firewallStatus.textContent = "é˜²ç«å¢™çŠ¶æ€: å·²å¯ç”¨";
                elements.firewallStatus.className = "firewall-status firewall-on";
            } else {
                elements.firewallStatus.textContent = "é˜²ç«å¢™çŠ¶æ€: å·²ç¦ç”¨";
                elements.firewallStatus.className = "firewall-status firewall-off";
            }
        }
        
        // é™ä½åˆ†è¾¨ç‡
        function decreaseResolution() {
            if (gameState.resolution > 0) {
                gameState.resolution--;
                elements.resolutionValue.textContent = gameState.resolutions[gameState.resolution];
            }
        }
        
        // æé«˜åˆ†è¾¨ç‡
        function increaseResolution() {
            if (gameState.resolution < gameState.resolutions.length - 1) {
                gameState.resolution++;
                elements.resolutionValue.textContent = gameState.resolutions[gameState.resolution];
            }
        }
        
        // åº”ç”¨è®¾ç½®
        function applySettings() {
            alert("ç³»ç»Ÿè®¾ç½®å·²åº”ç”¨ï¼");
            closeControlPanel();
        }
        
        // å…³é—­å¹¿å‘Šå¼¹çª—
        function closePopupAd() {
            elements.popupAd.style.display = 'none';
        }
        
        // å…³é—­å‹’ç´¢çª—å£
        function closeRansom() {
            elements.ransomWindow.style.display = 'none';
        }
        
        // å…³é—­ç»“æœçª—å£
        function closeResult() {
            elements.resultWindow.style.display = 'none';
        }
        
        // æ¸²æŸ“æ–‡ä»¶å¤¹è§†å›¾
        function renderFolderView(folderPath) {
            const folder = gameState.fileSystem[folderPath];
            if (!folder) return;
            
            gameState.currentExplorerPath = folderPath;
            
            // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
            elements.breadcrumb.innerHTML = `
                <div class="breadcrumb-item" data-path="root">æˆ‘çš„ç”µè„‘</div>
                <div class="breadcrumb-separator">&gt;</div>
                <div class="breadcrumb-item" data-path="${folderPath}">${folder.name}</div>
            `;
            
            // æ¸²æŸ“æ–‡ä»¶å¤¹åˆ—è¡¨
            let folderHTML = '';
            folder.items.filter(item => item.type === 'folder' || item.type === 'drive').forEach(item => {
                let icon = item.type === 'drive' ? 'fa-hdd' : 'fa-folder';
                folderHTML += `
                    <div class="explorer-item" data-path="${item.path}" data-type="${item.type}">
                        <i class="fas ${icon}"></i> ${item.name}
                    </div>
                `;
            });
            elements.folderPane.innerHTML = folderHTML;
            
            // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
            let fileHTML = '';
            folder.items.filter(item => item.type === 'file').forEach(item => {
                fileHTML += `
                    <div class="explorer-item" data-type="file">
                        <i class="fas fa-file"></i> ${item.name}
                    </div>
                `;
            });
            elements.filePane.innerHTML = fileHTML;
            
            // ç»‘å®šæ–‡ä»¶å¤¹é¡¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.explorer-item[data-path]').forEach(item => {
                item.addEventListener('click', function() {
                    const path = this.dataset.path;
                    renderFolderView(path);
                });
            });
        }
        
        // åœ¨æ–‡ä»¶æµè§ˆå™¨ä¸­åé€€
        function goBackInExplorer() {
            // ç®€åŒ–å®ç°ï¼šå›åˆ°æ ¹ç›®å½•
            renderFolderView('root');
        }
        
        // åœ¨æ–‡ä»¶æµè§ˆå™¨ä¸­å‰è¿›
        function goForwardInExplorer() {
            // ç®€åŒ–å®ç°ï¼šå›åˆ°æ ¹ç›®å½•
            renderFolderView('root');
        }
        
        // åœ¨æ–‡ä»¶æµè§ˆå™¨ä¸­å‘ä¸Š
        function goUpInExplorer() {
            // ç®€åŒ–å®ç°ï¼šå›åˆ°æ ¹ç›®å½•
            renderFolderView('root');
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = initGame;
    </script>
</body>
</html>